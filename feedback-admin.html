<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>ãƒ•ã‚£ãƒ¼ãƒ‰ãƒãƒƒã‚¯ç®¡ç† â€” ã‚·ã‚¹ãƒ†ãƒ æ”¹å–„</title>
  <style>
    * { box-sizing: border-box; margin: 0; padding: 0; }
    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Hiragino Sans', 'Noto Sans JP', sans-serif;
      background: #f9fafb;
      color: #111827;
      padding: 24px;
    }

    /* ãƒãƒ¼ã‚¿ãƒ«ã«æˆ»ã‚‹ãƒœã‚¿ãƒ³ - å›ºå®šä½ç½® */
    .back-to-portal {
      position: fixed;
      z-index: 9999;
      background: linear-gradient(135deg, #2563eb 0%, #7c3aed 100%);
      color: white;
      padding: 12px 20px;
      border-radius: 12px;
      text-decoration: none;
      font-weight: 700;
      font-size: 14px;
      box-shadow: 0 4px 12px rgba(37, 99, 235, 0.4);
      transition: all 0.3s ease;
      display: flex;
      align-items: center;
      gap: 8px;
      border: 2px solid rgba(255, 255, 255, 0.2);
    }
    .back-to-portal:hover {
      transform: translateY(-2px);
      box-shadow: 0 6px 20px rgba(37, 99, 235, 0.6);
      text-decoration: none;
    }
    .back-to-portal-top-left {
      top: 20px;
      left: 20px;
    }
    .back-to-portal-top-right {
      top: 20px;
      right: 20px;
    }
    .back-to-portal-bottom-left {
      bottom: 20px;
      left: 20px;
    }
    .back-to-portal-bottom-right {
      bottom: 20px;
      right: 20px;
    }
    @media (max-width: 768px) {
      .back-to-portal {
        padding: 10px 16px;
        font-size: 12px;
      }
      .back-to-portal-top-left,
      .back-to-portal-bottom-left {
        left: 10px;
      }
      .back-to-portal-top-right,
      .back-to-portal-bottom-right {
        right: 10px;
      }
    }
    .container {
      max-width: 1200px;
      margin: 0 auto;
    }
    .header {
      background: linear-gradient(135deg, #3b82f6 0%, #2563eb 100%);
      color: white;
      padding: 32px 40px;
      border-radius: 16px;
      margin-bottom: 24px;
      box-shadow: 0 4px 12px rgba(59, 130, 246, 0.3);
    }
    .header h1 {
      font-size: 28px;
      margin-bottom: 8px;
    }
    .header p {
      font-size: 14px;
      opacity: 0.9;
    }
    .stats {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
      gap: 16px;
      margin-bottom: 24px;
    }
    .stat-card {
      background: white;
      padding: 20px;
      border-radius: 12px;
      box-shadow: 0 1px 3px rgba(0,0,0,0.1);
    }
    .stat-label {
      font-size: 12px;
      color: #6b7280;
      font-weight: 600;
      margin-bottom: 8px;
    }
    .stat-value {
      font-size: 32px;
      font-weight: 800;
      color: #111827;
    }
    .stat-card.bug .stat-value { color: #dc2626; }
    .stat-card.improvement .stat-value { color: #2563eb; }
    .stat-card.question .stat-value { color: #d97706; }
    
    .filters {
      background: white;
      padding: 20px;
      border-radius: 12px;
      margin-bottom: 24px;
      display: flex;
      gap: 12px;
      flex-wrap: wrap;
      align-items: center;
    }
    .filter-btn {
      padding: 8px 16px;
      border: 1px solid #d1d5db;
      background: #f9fafb;
      border-radius: 8px;
      cursor: pointer;
      font-size: 13px;
      font-weight: 600;
      transition: all 0.2s;
    }
    .filter-btn:hover {
      background: #e5e7eb;
    }
    .filter-btn.active {
      background: #3b82f6;
      color: white;
      border-color: #3b82f6;
    }
    
    .actions {
      display: flex;
      gap: 12px;
      margin-left: auto;
    }
    .action-btn {
      padding: 8px 16px;
      border: none;
      border-radius: 8px;
      cursor: pointer;
      font-size: 13px;
      font-weight: 600;
      transition: all 0.2s;
    }
    .action-btn.export {
      background: #059669;
      color: white;
    }
    .action-btn.clear {
      background: #ef4444;
      color: white;
    }
    
    .feedback-list {
      display: flex;
      flex-direction: column;
      gap: 16px;
    }
    .feedback-item {
      background: white;
      padding: 24px;
      border-radius: 12px;
      box-shadow: 0 1px 3px rgba(0,0,0,0.1);
      border-left: 4px solid #3b82f6;
    }
    .feedback-item.bug { border-left-color: #dc2626; }
    .feedback-item.improvement { border-left-color: #2563eb; }
    .feedback-item.question { border-left-color: #d97706; }
    .feedback-item.other { border-left-color: #6b7280; }
    
    .feedback-header {
      display: flex;
      justify-content: space-between;
      align-items: start;
      margin-bottom: 12px;
    }
    .feedback-meta {
      display: flex;
      gap: 12px;
      align-items: center;
      flex-wrap: wrap;
    }
    .feedback-type-badge {
      padding: 4px 12px;
      border-radius: 12px;
      font-size: 11px;
      font-weight: 600;
    }
    .feedback-type-badge.bug { background: #fee2e2; color: #991b1b; }
    .feedback-type-badge.improvement { background: #dbeafe; color: #1e40af; }
    .feedback-type-badge.question { background: #fef3c7; color: #92400e; }
    .feedback-type-badge.other { background: #f3f4f6; color: #374151; }
    
    .feedback-location {
      font-size: 12px;
      color: #6b7280;
      font-weight: 600;
    }
    .feedback-time {
      font-size: 12px;
      color: #9ca3af;
    }
    .feedback-author {
      font-size: 12px;
      color: #6b7280;
      font-weight: 600;
    }
    
    .feedback-content {
      font-size: 14px;
      line-height: 1.6;
      color: #374151;
      white-space: pre-wrap;
      margin-bottom: 12px;
    }
    
    .feedback-actions {
      display: flex;
      gap: 8px;
    }
    .feedback-action-btn {
      padding: 6px 12px;
      border: 1px solid #d1d5db;
      background: white;
      border-radius: 6px;
      cursor: pointer;
      font-size: 12px;
      font-weight: 600;
      transition: all 0.2s;
    }
    .feedback-action-btn:hover {
      background: #f3f4f6;
    }
    .feedback-action-btn.delete {
      color: #dc2626;
      border-color: #fecaca;
    }
    .feedback-action-btn.delete:hover {
      background: #fee2e2;
    }
    
    .empty-state {
      background: white;
      padding: 60px 40px;
      border-radius: 12px;
      text-align: center;
      color: #9ca3af;
    }
    .empty-state-icon {
      font-size: 64px;
      margin-bottom: 16px;
    }
    
    /* è¦ç´ ç•ªå·ãƒãƒƒã‚¸ */
    .element-id {
      display: inline-flex;
      align-items: center;
      justify-content: center;
      font-size: 9px;
      font-weight: 700;
      font-family: monospace;
      color: #9ca3af;
      background: #f3f4f6;
      border: 1px solid #e5e7eb;
      border-radius: 4px;
      padding: 2px 5px;
      margin-left: 6px;
      vertical-align: middle;
      cursor: help;
      transition: all 0.2s;
    }
    .element-id:hover {
      background: #3b82f6;
      color: white;
      border-color: #3b82f6;
      transform: scale(1.1);
    }
  </style>
</head>
<body>
  <!-- ãƒãƒ¼ã‚¿ãƒ«ã«æˆ»ã‚‹ãƒœã‚¿ãƒ³ï¼ˆ4ç®‡æ‰€ï¼‰ -->
  <a href="lnportal.html" class="back-to-portal back-to-portal-top-left">â† ãƒãƒ¼ã‚¿ãƒ«</a>
  <a href="lnportal.html" class="back-to-portal back-to-portal-top-right">ãƒãƒ¼ã‚¿ãƒ« â†’</a>
  <a href="lnportal.html" class="back-to-portal back-to-portal-bottom-left">â† ãƒãƒ¼ã‚¿ãƒ«</a>
  <a href="lnportal.html" class="back-to-portal back-to-portal-bottom-right">ãƒãƒ¼ã‚¿ãƒ« â†’</a>
  <div class="container">
    <div class="header">
      <h1>ğŸ’¬ ãƒ•ã‚£ãƒ¼ãƒ‰ãƒãƒƒã‚¯ç®¡ç†</h1>
      <p>ãƒ¦ãƒ¼ã‚¶ãƒ¼ã‹ã‚‰ã®ä¿®æ­£ä¾é ¼ãƒ»æ”¹å–„ææ¡ˆãƒ»è³ªå•ã‚’ç¢ºèªã—ã¦ã€ã‚·ã‚¹ãƒ†ãƒ ã‚’ã‚ˆã‚Šè‰¯ãã—ã¾ã—ã‚‡ã†</p>
    </div>
    
    <div class="stats" id="stats">
      <div class="stat-card">
        <div class="stat-label">å…¨ãƒ•ã‚£ãƒ¼ãƒ‰ãƒãƒƒã‚¯</div>
        <div class="stat-value" id="stat-total">0</div>
      </div>
      <div class="stat-card bug">
        <div class="stat-label">ğŸ› ãƒã‚°ãƒ»ä¸å…·åˆ</div>
        <div class="stat-value" id="stat-bug">0</div>
      </div>
      <div class="stat-card improvement">
        <div class="stat-label">ğŸ’¡ æ”¹å–„ææ¡ˆ</div>
        <div class="stat-value" id="stat-improvement">0</div>
      </div>
      <div class="stat-card question">
        <div class="stat-label">â“ è³ªå•</div>
        <div class="stat-value" id="stat-question">0</div>
      </div>
    </div>
    
    <div class="filters">
      <button class="filter-btn active" data-filter="all" onclick="setFilter('all')">ã™ã¹ã¦<span class="element-id" title="è¦ç´ ID: FB-01">FB-01</span></button>
      <button class="filter-btn" data-filter="bug" onclick="setFilter('bug')">ğŸ› ãƒã‚°<span class="element-id" title="è¦ç´ ID: FB-02">FB-02</span></button>
      <button class="filter-btn" data-filter="improvement" onclick="setFilter('improvement')">ğŸ’¡ æ”¹å–„ææ¡ˆ<span class="element-id" title="è¦ç´ ID: FB-03">FB-03</span></button>
      <button class="filter-btn" data-filter="question" onclick="setFilter('question')">â“ è³ªå•<span class="element-id" title="è¦ç´ ID: FB-04">FB-04</span></button>
      <button class="filter-btn" data-filter="other" onclick="setFilter('other')">ğŸ“ ãã®ä»–<span class="element-id" title="è¦ç´ ID: FB-05">FB-05</span></button>
      
      <div class="actions">
        <button class="action-btn export" onclick="exportAllFeedbacks()">ğŸ“¥ ã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆ<span class="element-id" title="è¦ç´ ID: FB-10">FB-10</span></button>
        <button class="action-btn clear" onclick="clearAllFeedbacks()">ğŸ—‘ï¸ ã™ã¹ã¦å‰Šé™¤<span class="element-id" title="è¦ç´ ID: FB-11">FB-11</span></button>
      </div>
    </div>
    
    <div class="feedback-list" id="feedbackList"></div>
  </div>
  
  <script>
    let currentFilter = 'all';
    let allFeedbacks = [];
    
    // ãƒ•ã‚£ãƒ¼ãƒ‰ãƒãƒƒã‚¯ã‚’èª­ã¿è¾¼ã¿
    function loadFeedbacks() {
      const systemFeedbacks = JSON.parse(localStorage.getItem('system_feedbacks') || '[]');
      const manualFeedbacks = JSON.parse(localStorage.getItem('manual_feedbacks') || '[]')
        .map(f => ({...f, location: f.section ? `ãƒãƒ‹ãƒ¥ã‚¢ãƒ« ${f.section}` : 'ãƒãƒ‹ãƒ¥ã‚¢ãƒ«'}));
      
      allFeedbacks = [...systemFeedbacks, ...manualFeedbacks]
        .sort((a, b) => new Date(b.timestamp) - new Date(a.timestamp));
      
      updateStats();
      renderFeedbacks();
    }
    
    // çµ±è¨ˆã‚’æ›´æ–°
    function updateStats() {
      document.getElementById('stat-total').textContent = allFeedbacks.length;
      document.getElementById('stat-bug').textContent = allFeedbacks.filter(f => f.type === 'bug').length;
      document.getElementById('stat-improvement').textContent = allFeedbacks.filter(f => f.type === 'improvement').length;
      document.getElementById('stat-question').textContent = allFeedbacks.filter(f => f.type === 'question').length;
    }
    
    // ãƒ•ã‚£ãƒ«ã‚¿ã‚’è¨­å®š
    function setFilter(filter) {
      currentFilter = filter;
      document.querySelectorAll('.filter-btn').forEach(btn => {
        btn.classList.toggle('active', btn.dataset.filter === filter);
      });
      renderFeedbacks();
    }
    
    // ãƒ•ã‚£ãƒ¼ãƒ‰ãƒãƒƒã‚¯ã‚’è¡¨ç¤º
    function renderFeedbacks() {
      const container = document.getElementById('feedbackList');
      let filtered = allFeedbacks;
      
      if (currentFilter !== 'all') {
        filtered = allFeedbacks.filter(f => f.type === currentFilter);
      }
      
      if (filtered.length === 0) {
        container.innerHTML = `
          <div class="empty-state">
            <div class="empty-state-icon">ğŸ“­</div>
            <div style="font-size:16px;font-weight:600;margin-bottom:8px">ãƒ•ã‚£ãƒ¼ãƒ‰ãƒãƒƒã‚¯ãŒã‚ã‚Šã¾ã›ã‚“</div>
            <div style="font-size:14px">ãƒ¦ãƒ¼ã‚¶ãƒ¼ã‹ã‚‰ã®ãƒ•ã‚£ãƒ¼ãƒ‰ãƒãƒƒã‚¯ãŒã“ã“ã«è¡¨ç¤ºã•ã‚Œã¾ã™</div>
          </div>
        `;
        return;
      }
      
      container.innerHTML = filtered.map((f, index) => {
        const date = new Date(f.timestamp);
        const dateStr = `${date.getFullYear()}/${date.getMonth()+1}/${date.getDate()} ${date.getHours()}:${String(date.getMinutes()).padStart(2,'0')}`;
        const typeLabel = {
          'bug': 'ğŸ› ãƒã‚°',
          'improvement': 'ğŸ’¡ æ”¹å–„ææ¡ˆ',
          'question': 'â“ è³ªå•',
          'other': 'ğŸ“ ãã®ä»–'
        }[f.type] || 'ğŸ“ ãã®ä»–';
        
        return `
          <div class="feedback-item ${f.type}">
            <div class="feedback-header">
              <div class="feedback-meta">
                <span class="feedback-type-badge ${f.type}">${typeLabel}</span>
                <span class="feedback-location">ğŸ“ ${f.location || 'ãƒšãƒ¼ã‚¸ä¸æ˜'}</span>
                <span class="feedback-time">â° ${dateStr}</span>
                <span class="feedback-author">ğŸ‘¤ ${f.name || 'åŒ¿å'}</span>
              </div>
            </div>
            <div class="feedback-content">${escapeHtml(f.content || f.text || '')}</div>
            <div class="feedback-actions">
              <button class="feedback-action-btn delete" onclick="deleteFeedback('${f.id}')">ğŸ—‘ï¸ å‰Šé™¤</button>
            </div>
          </div>
        `;
      }).join('');
    }
    
    // HTMLã‚¨ã‚¹ã‚±ãƒ¼ãƒ—
    function escapeHtml(text) {
      const div = document.createElement('div');
      div.textContent = text;
      return div.innerHTML;
    }
    
    // ãƒ•ã‚£ãƒ¼ãƒ‰ãƒãƒƒã‚¯ã‚’å‰Šé™¤
    function deleteFeedback(id) {
      if (!confirm('ã“ã®ãƒ•ã‚£ãƒ¼ãƒ‰ãƒãƒƒã‚¯ã‚’å‰Šé™¤ã—ã¾ã™ã‹ï¼Ÿ')) return;
      
      // system_feedbacksã‹ã‚‰å‰Šé™¤
      let systemFeedbacks = JSON.parse(localStorage.getItem('system_feedbacks') || '[]');
      systemFeedbacks = systemFeedbacks.filter(f => f.id !== id);
      localStorage.setItem('system_feedbacks', JSON.stringify(systemFeedbacks));
      
      // manual_feedbacksã‹ã‚‰å‰Šé™¤
      let manualFeedbacks = JSON.parse(localStorage.getItem('manual_feedbacks') || '[]');
      manualFeedbacks = manualFeedbacks.filter(f => f.id !== id);
      localStorage.setItem('manual_feedbacks', JSON.stringify(manualFeedbacks));
      
      loadFeedbacks();
    }
    
    // ã™ã¹ã¦å‰Šé™¤
    function clearAllFeedbacks() {
      if (!confirm('ã™ã¹ã¦ã®ãƒ•ã‚£ãƒ¼ãƒ‰ãƒãƒƒã‚¯ã‚’å‰Šé™¤ã—ã¾ã™ã‹ï¼Ÿã“ã®æ“ä½œã¯å–ã‚Šæ¶ˆã›ã¾ã›ã‚“ã€‚')) return;
      
      localStorage.removeItem('system_feedbacks');
      localStorage.removeItem('manual_feedbacks');
      
      loadFeedbacks();
    }
    
    // ã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆ
    function exportAllFeedbacks() {
      if (allFeedbacks.length === 0) {
        alert('ã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆã™ã‚‹ãƒ•ã‚£ãƒ¼ãƒ‰ãƒãƒƒã‚¯ãŒã‚ã‚Šã¾ã›ã‚“');
        return;
      }
      
      const data = {
        exportDate: new Date().toISOString(),
        totalCount: allFeedbacks.length,
        feedbacks: allFeedbacks
      };
      
      const json = JSON.stringify(data, null, 2);
      const blob = new Blob([json], { type: 'application/json' });
      const url = URL.createObjectURL(blob);
      const a = document.createElement('a');
      a.href = url;
      a.download = `feedbacks_${new Date().toISOString().split('T')[0]}.json`;
      a.click();
      URL.revokeObjectURL(url);
    }
    
    // åˆæœŸåŒ–
    loadFeedbacks();
  </script>
</body>
</html>
