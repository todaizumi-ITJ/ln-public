<!DOCTYPE html>
<!-- LNãƒãƒ¼ã‚¿ãƒ«ãƒ¢ãƒƒã‚¯ - ã“ã®HTMLå˜ä½“ã§å‹•ä½œã—ã¾ã™ï¼ˆå¤–éƒ¨ãƒ•ã‚¡ã‚¤ãƒ«ãƒ»ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ä¸è¦ï¼‰ -->
<html lang="ja">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>LNãƒãƒ¼ã‚¿ãƒ« â€” é–‹ç¤ºè«‹æ±‚ãƒ»è£åˆ¤ç”¨</title>
  <style>
    :root {
      /* ãƒ•ã‚©ãƒ³ãƒˆè¨­å®š */
      --font: -apple-system, BlinkMacSystemFont, 'Hiragino Sans', 'Noto Sans JP', sans-serif;
      /* ãƒ¡ã‚¤ãƒ³ãƒ†ã‚­ã‚¹ãƒˆè‰² */
      --ink: #1f2937;
      --muted: #6b7280;
      --faint: #9ca3af;
      /* èƒŒæ™¯ãƒ»å¢ƒç•Œç·š */
      --surface: #ffffff;
      --surface2: #f9fafb;
      --border: #e5e7eb;
      /* ã‚¢ã‚¯ã‚»ãƒ³ãƒˆã‚«ãƒ©ãƒ¼ */
      --blue: #2563eb;
      --blue-bg: #eff6ff;
      --green: #059669;
      --green-bg: #ecfdf5;
      --yellow: #d97706;
      --yellow-bg: #fffbeb;
      --red: #dc2626;
      --red-bg: #fef2f2;
      --purple: #7e3af2;
      --purple-bg: #f5f3ff;
      /* ãƒ¬ã‚¤ã‚¢ã‚¦ãƒˆç”¨ */
      --bg: #f9fafb;
      --sidebar-bg: #ffffff;
      --accent: #2563eb;
    }
    * { box-sizing: border-box; margin: 0; padding: 0; }
    body { font-family: var(--font); background-color: var(--surface2); color: var(--ink); margin: 0; min-height: 100vh; }

    /* Layout: Sidebar + Main */
    .app-layout { display: flex; min-height: 100vh; }
    .sidebar {
      width: 260px; flex-shrink: 0; background: var(--sidebar-bg);
      border-right: 1px solid var(--border); padding: 24px 16px;
    }
    .sidebar-logo { font-size: 18px; font-weight: 800; color: var(--ink); margin-bottom: 32px; letter-spacing: -0.5px; }
    .sidebar-section { margin-bottom: 28px; }
    .sidebar-section-label { font-size: 10px; font-weight: 700; color: var(--faint); text-transform: uppercase; letter-spacing: 1.2px; margin-bottom: 12px; }
    .sidebar-nav-item {
      display: flex; align-items: center; gap: 10px; padding: 12px 14px; margin-bottom: 4px;
      border-radius: 10px; color: var(--muted); text-decoration: none; font-size: 13px; font-weight: 500;
      transition: all 0.2s; cursor: pointer;
    }
    .sidebar-nav-item:hover { background: var(--surface2); color: var(--ink); }
    .sidebar-nav-item.active { background: var(--blue-bg); color: var(--accent); }
    .main-area { flex: 1; display: flex; flex-direction: column; min-width: 0; }
    .header {
      background: var(--surface); color: var(--ink); padding: 18px 28px;
      border-bottom: 1px solid var(--border);
      display: flex; align-items: center; justify-content: space-between; flex-wrap: wrap; gap: 16px;
    }
    .header-title { font-size: 18px; font-weight: 700; }
    .header-actions { display: flex; align-items: center; gap: 12px; }
    .back-btn {
      display: inline-flex; align-items: center; gap: 6px;
      padding: 8px 14px; background: var(--surface2); color: var(--ink);
      border-radius: 8px; text-decoration: none; font-size: 13px; font-weight: 500;
      transition: background 0.2s; border: 1px solid var(--border);
    }
    .back-btn:hover { background: var(--border); }

    .container { flex: 1; max-width: 1100px; margin: 0 auto; padding: 28px 24px; width: 100%; }

    /* ã‚¿ã‚¹ã‚¯é¸æŠï¼ˆãƒ¦ãƒ¼ã‚¶ãƒ¼ç›®ç·šã®å…¥å£ï¼‰ */
    .task-intro {
      background: var(--surface);
      border-radius: 14px;
      padding: 24px 28px;
      margin-bottom: 28px;
      border: 1px solid var(--border);
      box-shadow: 0 1px 3px rgba(0,0,0,0.04);
    }
    .task-intro h2 { font-size: 15px; color: var(--muted); margin-bottom: 16px; font-weight: 600; }
    .task-intro h2::before { content: "ğŸ’¡ "; }
    .task-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(260px, 1fr));
      gap: 14px;
    }
    .task-card {
      padding: 20px 22px;
      border-radius: 12px;
      border: 2px solid var(--border);
      background: var(--surface);
      cursor: pointer;
      transition: all 0.2s;
      text-decoration: none;
      color: inherit;
      display: block;
    }
    .task-card:hover {
      border-color: var(--blue);
      background: var(--blue-bg);
      transform: translateY(-2px);
      box-shadow: 0 4px 20px rgba(59,130,246,0.2);
    }
    .task-card .icon { font-size: 28px; margin-bottom: 10px; }
    .task-card h3 { font-size: 15px; font-weight: 700; margin-bottom: 6px; }
    .task-card p { font-size: 12px; color: var(--muted); line-height: 1.6; }

    /* LNä¸€è¦§ */
    .section-title { font-size: 18px; font-weight: 700; margin-bottom: 16px; display: flex; align-items: center; gap: 10px; }
    .card {
      background: var(--surface);
      border-radius: 12px;
      border: 1px solid var(--border);
      margin-bottom: 16px;
      overflow: hidden;
      box-shadow: 0 1px 3px rgba(0,0,0,0.04);
    }
    .card-head {
      padding: 16px 20px;
      border-bottom: 1px solid var(--border);
      display: flex;
      align-items: center;
      justify-content: space-between;
      flex-wrap: wrap;
      gap: 10px;
    }
    .card-title { font-size: 14px; font-weight: 700; }
    .card-body { padding: 16px 20px; }

    /* æº–å‚™çŠ¶æ³ãƒãƒƒã‚¸ï¼ˆãƒ”ãƒ«å‹ï¼‰ */
    .status-badge {
      display: inline-flex;
      align-items: center;
      padding: 5px 12px;
      border-radius: 20px;
      font-size: 11px;
      font-weight: 600;
    }
    .status-ready { background: var(--green-bg); color: var(--green); }
    .status-processing { background: var(--blue-bg); color: var(--blue); }
    .status-pending { background: var(--yellow-bg); color: var(--yellow); }
    .status-action { background: var(--red-bg); color: var(--red); }

    /* LNè¡Œ */
    .ln-row {
      display: grid;
      grid-template-columns: 1fr 100px 90px 120px 100px;
      gap: 12px;
      padding: 14px 20px;
      align-items: center;
      border-bottom: 1px solid var(--border);
      transition: background 0.15s;
      cursor: pointer;
      text-decoration: none;
      color: inherit;
    }
    .ln-row:last-child { border-bottom: none; }
    .ln-row:hover { background: var(--surface2); }
    @media (max-width: 700px) {
      .ln-row { grid-template-columns: 1fr auto; gap: 8px; }
      .ln-row .hide-mobile { display: none; }
    }
    .ln-num { font-family: monospace; font-weight: 700; font-size: 14px; color: var(--accent); }
    .ln-meta { font-size: 12px; color: var(--muted); margin-top: 2px; }


    /* ====== LNä¸€è¦§ ã‚«ãƒ¼ãƒ‰ã‚¹ã‚¿ã‚¤ãƒ« ====== */
    .ln-card {
      background: #ffffff;
      border: 1px solid var(--border);
      border-radius: 14px;
      margin-bottom: 10px;
      overflow: hidden;
      transition: box-shadow 0.2s, border-color 0.2s;
    }
    .ln-card:hover {
      border-color: #c7d2e0;
      box-shadow: 0 2px 12px rgba(0,0,0,0.06);
    }
    .ln-card-head {
      display: flex;
      align-items: center;
      justify-content: space-between;
      padding: 14px 18px;
      cursor: pointer;
      gap: 12px;
    }
    .ln-card-left {
      display: flex;
      align-items: center;
      gap: 14px;
      min-width: 0;
      flex: 1;
    }
    .ln-card-num {
      font-family: 'SF Mono', Menlo, Consolas, monospace;
      font-size: 15px;
      font-weight: 800;
      color: var(--accent);
      background: #f0f4ff;
      padding: 6px 12px;
      border-radius: 8px;
      white-space: nowrap;
      letter-spacing: -0.02em;
    }
    .ln-card-parties {
      font-size: 13px;
      color: var(--text-secondary);
      font-weight: 500;
      min-width: 0;
      white-space: nowrap;
      overflow: hidden;
      text-overflow: ellipsis;
    }
    .ln-card-right {
      display: flex;
      align-items: center;
      gap: 10px;
      flex-shrink: 0;
    }
    .ln-card-ip {
      font-family: monospace;
      font-size: 12px;
      font-weight: 700;
      color: #1d4ed8;
      background: #eff6ff;
      padding: 3px 10px;
      border-radius: 6px;
      white-space: nowrap;
    }
    .ln-card-date {
      font-size: 11px;
      color: var(--muted);
      white-space: nowrap;
    }
    .ln-card-arrow {
      font-size: 10px;
      color: var(--muted);
      transition: transform 0.2s;
    }
    /* Progress strip */
    .ln-card-bars {
      display: flex;
      align-items: center;
      gap: 16px;
      padding: 0 18px 12px;
    }
    .ln-bar-group {
      display: flex;
      align-items: center;
      gap: 8px;
    }
    .ln-bar-label {
      font-size: 10px;
      color: var(--muted);
      font-weight: 600;
      min-width: 28px;
      flex-shrink: 0;
    }
    .ln-bar-pct {
      font-size: 11px;
      font-weight: 700;
      font-family: monospace;
      min-width: 48px;
      text-align: center;
      flex-shrink: 0;
      padding: 4px 10px;
      border-radius: 6px;
      transition: all 0.2s;
    }
    .ln-card-docs {
      font-family: monospace;
      font-size: 12px;
      letter-spacing: 2px;
      flex-shrink: 0;
      padding: 2px 8px;
      border-radius: 6px;
      background: #f9fafb;
    }
    /* Expand detail */
    .ln-expand-detail {
      background: #f8f9fb;
      border-top: 1px solid var(--border);
      padding: 16px 20px;
      animation: slideDown 0.2s ease;
    }
    @keyframes slideDown { from { opacity: 0; max-height: 0; } to { opacity: 1; max-height: 400px; } }
    .ln-expand-grid {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 10px 28px;
    }
    .ln-expand-item {
      display: flex;
      gap: 8px;
      margin-bottom: 4px;
      font-size: 12px;
    }
    .ln-expand-label {
      color: var(--muted);
      min-width: 100px;
      flex-shrink: 0;
      font-weight: 500;
    }
    .ln-expand-val {
      color: var(--text-primary);
      font-weight: 600;
    }
    .ev-missing { font-family: monospace; font-size: 11px; }
    .ln-expand-actions {
      margin-top: 14px;
      display: flex;
      gap: 10px;
      flex-wrap: wrap;
    }
    .ln-open-makeln {
      font-size: 12px;
      font-weight: 700;
      padding: 8px 18px;
      border-radius: 10px;
      text-decoration: none;
      transition: all 0.2s;
      background: linear-gradient(135deg, #2563eb 0%, #1d4ed8 100%);
      color: #fff;
      box-shadow: 0 2px 6px rgba(37,99,235,0.25);
    }
    .ln-open-makeln:hover {
      background: linear-gradient(135deg, #1d4ed8 0%, #1e40af 100%);
      box-shadow: 0 4px 12px rgba(37,99,235,0.35);
      transform: translateY(-1px);
    }
    .ln-drive-link {
      font-size: 12px;
      font-weight: 600;
      padding: 8px 16px;
      border-radius: 10px;
      text-decoration: none;
      transition: all 0.2s;
      background: linear-gradient(135deg, #10b981 0%, #059669 100%);
      color: #fff;
      box-shadow: 0 2px 6px rgba(16,185,129,0.25);
      white-space: nowrap;
    }
    .ln-drive-link:hover {
      background: linear-gradient(135deg, #059669 0%, #047857 100%);
      box-shadow: 0 4px 12px rgba(16,185,129,0.35);
      transform: translateY(-1px);
    }
    .ln-db-files-btn {
      font-size: 12px;
      font-weight: 600;
      padding: 8px 16px;
      border-radius: 10px;
      border: 2px dashed #d1d5db;
      background: #f9fafb;
      color: #9ca3af;
      cursor: not-allowed;
      transition: all 0.2s;
      white-space: nowrap;
    }
    .ln-db-files-btn:not(:disabled) {
      border-color: #7c3aed;
      background: linear-gradient(135deg, #7c3aed 0%, #6d28d9 100%);
      color: #fff;
      cursor: pointer;
      box-shadow: 0 2px 6px rgba(124,58,237,0.25);
    }
    .ln-db-files-btn:not(:disabled):hover {
      background: linear-gradient(135deg, #6d28d9 0%, #5b21b6 100%);
      box-shadow: 0 4px 12px rgba(124,58,237,0.35);
      transform: translateY(-1px);
    }
    @media (max-width: 700px) {
      .ln-card-head { flex-wrap: wrap; }
      .ln-card-bars { flex-wrap: wrap; gap: 8px; }
      .ln-expand-grid { grid-template-columns: 1fr; }
    }

    /* ãƒã‚§ãƒƒã‚¯ãƒªã‚¹ãƒˆï¼ˆç”³ç«‹æº–å‚™ï¼‰ */
    .checklist {
      background: var(--surface);
      border-radius: 12px;
      border: 1px solid var(--border);
      overflow: hidden;
    }
    .checklist-head {
      padding: 14px 18px;
      background: var(--surface2);
      border-bottom: 1px solid var(--border);
      font-size: 13px; font-weight: 700;
    }
    .checklist-item {
      padding: 12px 18px;
      display: flex;
      align-items: center;
      gap: 12px;
      border-bottom: 1px solid var(--border);
    }
    .checklist-item:last-child { border-bottom: none; }
    .check-icon { width: 24px; height: 24px; border-radius: 50%; display: flex; align-items: center; justify-content: center; font-size: 12px; flex-shrink: 0; }
    .check-icon.ok { background: var(--green-bg); color: var(--green); }
    .check-icon.ng { background: var(--red-bg); color: var(--red); }
    .check-icon.wip { background: var(--blue-bg); color: var(--blue); }
    .checklist-group { margin-bottom: 20px; }
    .checklist-group-title { font-size: 12px; font-weight: 700; color: var(--muted); margin-bottom: 10px; padding-bottom: 6px; border-bottom: 2px solid var(--border); text-transform: uppercase; letter-spacing: 0.5px; }
    .checklist-group-title.create { color: var(--blue); border-bottom-color: var(--blue); }
    .checklist-group-title.collect { color: var(--green); border-bottom-color: var(--green); }
    .auto-badge { font-size: 9px; padding: 2px 6px; border-radius: 4px; font-weight: 600; margin-left: 6px; }
    .auto-badge.auto { background: var(--green-bg); color: var(--green); }
    .auto-badge.partial { background: var(--yellow-bg); color: var(--yellow); }
    .auto-badge.manual { background: var(--surface2); color: var(--muted); }
    .sidebar-feedback { margin-top: 20px; padding-top: 16px; border-top: 1px solid var(--border); }
    .sidebar-feedback-title { font-size: 10px; font-weight: 700; color: var(--muted); text-transform: uppercase; letter-spacing: 0.5px; margin-bottom: 8px; }
    .sidebar-feedback-content { font-size: 11px; color: var(--ink); line-height: 1.6; padding: 10px 12px; background: var(--surface2); border-radius: 8px; min-height: 60px; max-height: 120px; overflow-y: auto; }
    .sidebar-feedback-content.empty { color: var(--faint); font-style: italic; }
    .sidebar-feedback-link { display: block; margin-top: 8px; font-size: 11px; color: var(--blue); font-weight: 600; text-decoration: none; }
    .sidebar-feedback-link:hover { text-decoration: underline; }

    /* ã‚¢ã‚¯ã‚·ãƒ§ãƒ³ãƒœã‚¿ãƒ³ç¾¤ */
    .action-bar {
      display: flex;
      flex-wrap: wrap;
      gap: 10px;
      margin-bottom: 20px;
    }
    .btn {
      display: inline-flex;
      align-items: center;
      gap: 6px;
      padding: 10px 16px;
      border-radius: 8px;
      font-size: 13px;
      font-weight: 600;
      border: none;
      cursor: pointer;
      transition: all 0.2s;
      text-decoration: none;
      color: inherit;
    }
    .btn-primary { background: var(--blue); color: white; }
    .btn-primary:hover { background: #1d4ed8; box-shadow: 0 2px 8px rgba(37,99,235,0.3); }
    .btn-secondary { background: var(--surface2); color: var(--ink); border: 1px solid var(--border); }
    .btn-secondary:hover { background: var(--border); }
    .btn-danger { background: var(--red-bg); color: var(--red); border: 1px solid #fecaca; }
    .btn-danger:hover { background: #fee2e2; }

    /* ãƒ†ãƒ¼ãƒ–ãƒ« */
    .table-wrap { overflow-x: auto; }
    table { width: 100%; border-collapse: collapse; font-size: 12px; }
    th {
      text-align: left;
      padding: 10px 12px;
      font-size: 10px;
      font-weight: 700;
      color: var(--faint);
      text-transform: uppercase;
      letter-spacing: 0.5px;
      border-bottom: 2px solid var(--border);
      background: var(--surface2);
    }
    td { padding: 10px 12px; border-bottom: 1px solid var(--border); }
    tr:hover td { background: var(--surface2); }
    .mono { font-family: monospace; font-size: 11px; }

    .tag { font-size: 10px; padding: 2px 8px; border-radius: 4px; font-weight: 600; }
    .tag-green { background: var(--green-bg); color: var(--green); }
    .tag-blue { background: var(--blue-bg); color: var(--blue); }
    .tag-yellow { background: var(--yellow-bg); color: var(--yellow); }
    .tag-red { background: var(--red-bg); color: var(--red); }

    /* éš ã—ãƒ‘ãƒãƒ« */
    .panel { display: none; }
    .panel.active { display: block; }

    /* ã‚¿ãƒ– */
    .tabs { display: flex; gap: 4px; margin-bottom: 16px; flex-wrap: wrap; }
    .tab { padding: 10px 18px; border-radius: 8px; font-size: 13px; font-weight: 600; cursor: pointer; transition: all 0.2s; background: var(--surface2); color: var(--muted); border: 1px solid var(--border); }
    .tab:hover { background: var(--border); color: var(--ink); }
    .tab.active { background: var(--blue); color: white; border-color: var(--blue); }
    .tab .count { font-size: 11px; opacity: 0.9; margin-left: 4px; }

    /* ã‚µãƒãƒªãƒ¼ã‚«ãƒ¼ãƒ‰ï¼ˆã‚¯ãƒªãƒƒã‚¯å¯èƒ½ï¼‰ */
    .summary-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(140px, 1fr)); gap: 12px; }
    .summary-card { padding: 16px; border-radius: 10px; cursor: pointer; transition: all 0.2s; border: 2px solid transparent; }
    .summary-card:hover { transform: translateY(-2px); box-shadow: 0 4px 12px rgba(0,0,0,0.08); }
    .summary-card.all { background: var(--surface2); }
    .summary-card.all:hover { border-color: var(--muted); }
    .summary-card.ready { background: var(--green-bg); }
    .summary-card.ready:hover { border-color: var(--green); }
    .summary-card.processing { background: var(--blue-bg); }
    .summary-card.processing:hover { border-color: var(--blue); }
    .summary-card.action { background: var(--yellow-bg); }
    .summary-card.action:hover { border-color: var(--yellow); }
    .summary-label { font-size: 11px; color: var(--muted); margin-bottom: 4px; }
    .summary-val { font-size: 22px; font-weight: 700; }
    .summary-card.ready .summary-val { color: var(--green); }
    .summary-card.processing .summary-val { color: var(--blue); }
    .summary-card.action .summary-val { color: var(--yellow); }
    .summary-hint { font-size: 10px; color: var(--faint); margin-top: 6px; }

    /* æ¤œç´¢ */
    .search-row { display: flex; gap: 10px; margin-bottom: 16px; flex-wrap: wrap; }
    .search-input { flex: 1; min-width: 200px; padding: 10px 14px; border: 1px solid var(--border); border-radius: 8px; font-size: 13px; background: var(--surface); color: var(--ink); }
    .search-input:focus { outline: none; border-color: var(--blue); box-shadow: 0 0 0 2px rgba(59,130,246,0.2); }

    /* é€²æ—ãƒãƒ¼ */
    .progress-row { display: flex; align-items: center; gap: 12px; margin-bottom: 8px; font-size: 12px; }
    .progress-label { min-width: 80px; color: var(--muted); }
    .progress-bar-wrap { flex: 1; height: 8px; background: var(--surface2); border-radius: 4px; overflow: hidden; }
    .progress-bar-fill { height: 100%; border-radius: 4px; transition: width 0.3s; }
    .progress-bar-fill.green { background: var(--green); }
    .progress-bar-fill.blue { background: var(--blue); }
    .progress-bar-fill.yellow { background: var(--yellow); }
    .progress-num { font-family: monospace; font-size: 11px; font-weight: 600; min-width: 50px; text-align: right; }

    /* ç©ºçŠ¶æ…‹ */
    .empty-state { padding: 40px 20px; text-align: center; color: var(--muted); font-size: 13px; }

    /* ã‚¬ã‚¤ãƒ‰ãƒ»ä½œæ¥­èª¬æ˜ */
    .guide-box { background: var(--surface2); border-left: 4px solid var(--blue); border-radius: 0 8px 8px 0; padding: 14px 18px; margin-bottom: 20px; font-size: 12px; line-height: 1.7; }
    .guide-box h3 { font-size: 12px; font-weight: 700; color: var(--ink); margin-bottom: 8px; }
    .guide-box ul { margin: 6px 0 0 16px; padding: 0; }
    .guide-box li { margin-bottom: 4px; }
    .guide-box .label { font-weight: 600; color: var(--muted); margin-right: 4px; }
    .task-meta { margin-top: 10px; padding-top: 10px; border-top: 1px dashed var(--border); font-size: 11px; color: var(--muted); }
    .task-meta .why { margin-bottom: 4px; }
    .task-meta .info { }

        /* æ¥­å‹™ãƒãƒƒãƒ—ï¼†ã‚¹ãƒ†ãƒƒãƒ—ãƒŠãƒ“ */
    .biz-map { margin-bottom: 24px; }
    .biz-map-title { font-size: 15px; font-weight: 700; margin-bottom: 16px; color: var(--ink); }
    .biz-map-subtitle { font-size: 12px; color: var(--muted); margin-bottom: 20px; line-height: 1.6; }
    .biz-columns { display: grid; grid-template-columns: 1fr 1fr; gap: 20px; }
    .biz-column { border-radius: 12px; padding: 20px; position: relative; }
    .biz-column.collect { background: linear-gradient(135deg, #ecfdf5 0%, #f0fdf4 100%); border: 2px solid var(--green); }
    .biz-column.create { background: linear-gradient(135deg, #eff6ff 0%, #dbeafe 100%); border: 2px solid var(--blue); }
    .biz-column-head { display: flex; align-items: center; gap: 10px; margin-bottom: 14px; }
    .biz-column-icon { font-size: 24px; }
    .biz-column-label { font-size: 15px; font-weight: 700; }
    .biz-column-desc { font-size: 11px; color: var(--muted); margin-bottom: 16px; line-height: 1.6; }
    .biz-step-list { display: flex; flex-direction: column; gap: 8px; }
    .biz-step { display: flex; align-items: flex-start; gap: 10px; padding: 10px 14px; border-radius: 8px; background: rgba(255,255,255,0.7); cursor: pointer; transition: all 0.2s; border: 1px solid transparent; }
    .biz-step:hover { transform: translateY(-1px); box-shadow: 0 2px 8px rgba(0,0,0,0.06); border-color: var(--border); }
    .biz-step.locked { opacity: 0.35; cursor: default; pointer-events: none; }
    .biz-step.locked:hover { transform: none; box-shadow: none; }
    .biz-step-num { width: 24px; height: 24px; border-radius: 50%; display: flex; align-items: center; justify-content: center; font-size: 11px; font-weight: 700; color: white; flex-shrink: 0; margin-top: 1px; }
    .biz-step-num.green { background: var(--green); }
    .biz-step-num.blue { background: var(--blue); }
    .biz-step-num.purple { background: var(--purple); }
    .biz-step-num.gray { background: var(--faint); }
    .biz-step-info { flex: 1; min-width: 0; }
    .biz-step-name { font-size: 13px; font-weight: 600; margin-bottom: 2px; }
    .biz-step-detail { font-size: 10px; color: var(--muted); line-height: 1.5; }
    .biz-step-badge { font-size: 9px; padding: 2px 8px; border-radius: 10px; font-weight: 600; white-space: nowrap; margin-top: 2px; }
    .biz-step-badge.beginner { background: var(--green-bg); color: var(--green); border: 1px solid var(--green); }
    .biz-step-badge.expert { background: var(--blue-bg); color: var(--blue); border: 1px solid var(--blue); }
    .biz-step-badge.leader { background: var(--purple-bg); color: var(--purple); border: 1px solid var(--purple); }
    .role-legend { display: flex; gap: 12px; margin-top: 16px; padding-top: 14px; border-top: 1px dashed var(--border); font-size: 11px; color: var(--muted); flex-wrap: wrap; }
    .role-legend-item { display: flex; align-items: center; gap: 6px; }
    .role-legend-dot { width: 10px; height: 10px; border-radius: 50%; }
    .role-legend-dot.green { background: var(--green); }
    .role-legend-dot.blue { background: var(--blue); }
    .role-legend-dot.purple { background: var(--purple); }
    .your-tasks-highlight { background: rgba(255,255,255,0.9); border: 2px solid var(--green); border-radius: 10px; padding: 14px; margin-bottom: 20px; }
    .your-tasks-title { font-size: 13px; font-weight: 700; margin-bottom: 8px; display: flex; align-items: center; gap: 8px; }
    @media (max-width: 768px) {
      .biz-columns { grid-template-columns: 1fr; }
    }

    /* ç”³ç«‹æ›¸ãƒ†ãƒ³ãƒ—ãƒ¬é›† */
    .template-accordion { border: 1px solid var(--border); border-radius: 8px; overflow: hidden; }
    .template-item { border-bottom: 1px solid var(--border); }
    .template-item:last-child { border-bottom: none; }
    .template-item summary { padding: 12px 16px; cursor: pointer; font-weight: 600; font-size: 13px; background: var(--surface2); list-style: none; display: flex; justify-content: space-between; align-items: center; }
    .template-item summary::-webkit-details-marker { display: none; }
    .template-item summary::after { content: "â–¼"; font-size: 10px; color: var(--muted); }
    .template-item[open] summary::after { content: "â–²"; }
    .template-item .template-body { padding: 14px 18px; background: var(--surface); font-size: 11px; line-height: 1.8; white-space: pre-wrap; max-height: 300px; overflow-y: auto; font-family: "Hiragino Mincho ProN", "Yu Mincho", serif; }
    .template-tags { font-size: 10px; color: var(--muted); margin-left: 8px; }

    /* è¨¼æ‹ èª¬æ˜æ›¸ã‚¬ã‚¤ãƒ‰ï¼ˆdetailsï¼‰ */
    details.card summary::-webkit-details-marker { display: none; }
    details.card summary::after { content: " â–¼"; font-size: 11px; color: var(--muted); font-weight: 400; }
    details.card[open] summary::after { content: " â–²"; }

        /* ãƒ¬ãƒãƒ¼ãƒˆCSS â†’ lngame.html ã«ç§»å‹• */

        /* ãƒªãƒ¼ãƒ€ãƒ¼ãƒœãƒ¼ãƒ‰CSS â†’ lngame.html ã«ç§»å‹• */

        /* æ›¸é¡ãƒœãƒƒã‚¯ã‚¹è©°ã‚CSS â†’ lnmanual.html ã«ç§»å‹• */

        /* ã‚¦ã‚§ãƒ«ã‚«ãƒ æˆç¸¾CSS â†’ lngame.html ã«ç§»å‹•ï¼ˆãƒãƒ¼ã‚¿ãƒ«ã§ã¯ä¸ä½¿ç”¨ï¼‰ */

        /* ãƒˆãƒƒãƒ—ã‚¦ã‚§ãƒ«ã‚«ãƒ CSS â†’ ç°¡ç•¥ç‰ˆã‚’ä¸‹ã«å®šç¾© */

        /* ãƒãƒ‹ãƒ¥ã‚¢ãƒ«ãƒšãƒ¼ã‚¸CSS â†’ lnmanual.html ã«ç§»å‹• */

    .ln-view-mode-tabs { display: flex; gap: 4px; margin-bottom: 16px; flex-wrap: wrap; }
    .ln-view-mode-tab { padding: 8px 16px; font-size: 13px; font-weight: 600; border-radius: 8px; border: 1px solid var(--border); background: var(--surface2); cursor: pointer; color: var(--muted); }
    .ln-view-mode-tab:hover { background: var(--border); color: var(--ink); }
    .ln-view-mode-tab.active { background: var(--purple); color: white; border-color: var(--purple); }
    /* LNçŠ¶æ³ï¼ˆæ›¸é¡æŠŠæ¡ï¼‰ */
    .ln-status-tabs { display: flex; gap: 4px; margin-bottom: 16px; flex-wrap: wrap; }
    .ln-status-tabs button { padding: 8px 14px; font-size: 12px; font-weight: 600; border-radius: 8px; border: 1px solid var(--border); background: var(--surface2); cursor: pointer; color: var(--muted); }
    .ln-status-tabs button:hover { background: var(--border); color: var(--ink); }
    .ln-status-tabs button.active { background: var(--purple); color: white; border-color: var(--purple); }
    .ln-status-table { width: 100%; border-collapse: collapse; font-size: 12px; }
    .ln-status-table th, .ln-status-table td { padding: 10px 12px; text-align: left; border-bottom: 1px solid var(--border); }
    .ln-status-table th { background: var(--surface2); font-weight: 600; color: var(--muted); }
    .ln-status-table tr { cursor: pointer; }
    .ln-status-table tr:hover { background: var(--surface2); }
    .ln-status-table .doc-ok { color: var(--green); font-weight: 600; }
    .ln-status-table .doc-ng { color: var(--red); }
    .ln-status-table .status-go { background: var(--green-bg); }
    .doc-cell { display: flex; align-items: center; gap: 8px; }
    .doc-status-checkbox { 
      appearance: none; -webkit-appearance: none; width: 18px; height: 18px; 
      border: 2px solid #d1d5db; border-radius: 5px; cursor: pointer; 
      transition: all 0.2s; background: white; position: relative; flex-shrink: 0;
    }
    .doc-status-checkbox:checked { 
      background: #059669; border-color: #059669; 
    }
    .doc-status-checkbox:checked::after { 
      content: 'âœ“'; position: absolute; inset: 0; 
      display: flex; align-items: center; justify-content: center; 
      color: white; font-size: 12px; font-weight: 700; 
    }
    .doc-status-checkbox:hover { 
      border-color: #9ca3af; transform: scale(1.05); 
    }
    
    /* è¦ç´ ç•ªå·ãƒãƒƒã‚¸ */
    .element-id {
      display: inline-flex;
      align-items: center;
      justify-content: center;
      font-size: 9px;
      font-weight: 700;
      font-family: monospace;
      color: #9ca3af;
      background: #f3f4f6;
      border: 1px solid #e5e7eb;
      border-radius: 4px;
      padding: 2px 5px;
      margin-left: 6px;
      vertical-align: middle;
      cursor: help;
      transition: all 0.2s;
    }
    .element-id:hover {
      background: #3b82f6;
      color: white;
      border-color: #3b82f6;
      transform: scale(1.1);
    }
  
        /* Promotion & Level CSS â†’ lngame.html ã«ç§»å‹• */

</style>
</head>
<body>

  <div class="app-layout">
    <aside class="sidebar">
      <div class="sidebar-logo">LN PORTAL v3.0</div>
      <div class="sidebar-section">
        <div class="sidebar-section-label">ãƒ¡ãƒ‹ãƒ¥ãƒ¼</div>
        <a href="#" class="sidebar-nav-item active" onclick="showPanel('top'); return false;">ğŸ“‹ ãƒ›ãƒ¼ãƒ <span class="element-id" title="è¦ç´ ID: P-01">P-01</span></a>
        <a href="#" class="sidebar-nav-item" onclick="showPanel('list'); return false;">ğŸ“„ LNä¸€è¦§<span class="element-id" title="è¦ç´ ID: P-02">P-02</span></a>
        <a href="lnmanual.html" class="sidebar-nav-item" target="_blank">ğŸ“š ãƒãƒ‹ãƒ¥ã‚¢ãƒ«<span class="element-id" title="è¦ç´ ID: P-03">P-03</span></a>
        <a href="lngame.html" class="sidebar-nav-item" target="_blank">ğŸ® å®Ÿç¸¾ãƒ»ãƒ¬ãƒ™ãƒ«<span class="element-id" title="è¦ç´ ID: P-04">P-04</span></a>
      </div>
      <div class="sidebar-feedback" id="sidebar-feedback">
        <div class="sidebar-feedback-title">âš ï¸ è‡ªå‹•åŒ–ã§ããªã„ã“ã¨</div>
        <div class="sidebar-feedback-content" id="sidebar-feedback-content">LNè©³ç´°ã‚’é–‹ãã¨ã€è‡ªå‹•åŒ–ã§ããªã‹ã£ãŸé …ç›®ãŒã“ã“ã«è¡¨ç¤ºã•ã‚Œã¾ã™ã€‚</div>
        <a href="#" class="sidebar-feedback-link" onclick="openFeedbackModal(); return false;">ğŸ“ ãƒ•ã‚£ãƒ¼ãƒ‰ãƒãƒƒã‚¯ã‚’æ›¸ã â†’</a>
        <div id="feedback-log" style="margin-top: 12px; font-size: 10px; color: var(--muted); max-height: 100px; overflow-y: auto;"></div>
      </div>
    </aside>
    <div class="main-area">
  <header class="header">
    <div style="display: flex; align-items: center; gap: 16px; flex-wrap: wrap;">
      <span class="header-title">ç”³ç«‹æ›¸ä½œæˆãƒãƒ¼ã‚¿ãƒ«</span>
    </div>
    <div class="header-actions">
        <select id="user-select" onchange="setUser(this.value)" style="padding: 6px 12px; border-radius: 6px; font-size: 13px; font-weight: 600; background: var(--surface); color: var(--ink); border: 1px solid var(--border); min-width: 140px;">
          <optgroup label="beginner">
            <option value="nobunaga">ç¹”ç”°ä¿¡é•·</option>
            <option value="hideyoshi">è±Šè‡£ç§€å‰</option>
            <option value="ieyasu">å¾³å·å®¶åº·</option>
          </optgroup>
          <optgroup label="expert">
            <option value="masamune">ä¼Šé”æ”¿å®—</option>
            <option value="yukimura">çœŸç”°å¹¸æ‘</option>
            <option value="kenshin">ä¸Šæ‰è¬™ä¿¡</option>
          </optgroup>
          <optgroup label="leader">
            <option value="yoritomo">æºé ¼æœ</option>
            <option value="takauji">è¶³åˆ©å°Šæ°</option>
          </optgroup>
        </select>
    </div>
  </header>

  <main class="container">

    <!-- ========== ãƒˆãƒƒãƒ—: æ¥­å‹™å…¨ä½“ãƒãƒƒãƒ—ï¼‹ãƒ­ãƒ¼ãƒ«åˆ¥ã‚¹ãƒ†ãƒƒãƒ— ========== -->
    <div id="panel-top" class="panel active">

      <!-- ã‚¦ã‚§ãƒ«ã‚«ãƒ  -->
      <div id="top-welcome" class="card">
        <div class="card-body" style="padding: 20px 24px;">
          <div style="display: flex; align-items: center; justify-content: space-between; flex-wrap: wrap; gap: 12px;">
            <div>
              <div style="font-size: 11px; color: var(--muted); margin-bottom: 4px;">ãƒ­ã‚°ã‚¤ãƒ³ä¸­</div>
              <div style="font-size: 17px; font-weight: 700;"><span id="welcome-name">â€”</span> <span id="welcome-role" style="font-size: 12px; font-weight: 600; padding: 2px 10px; border-radius: 10px;">â€”</span></div>
            </div>
            <div id="welcome-desc" style="font-size: 12px; color: var(--muted); max-width: 400px; line-height: 1.6;">â€”</div>
          </div>
        </div>
      </div>

      <!-- ã‚ãªãŸã®ä»Šæ—¥ã®ã‚¿ã‚¹ã‚¯ -->
      <div id="your-tasks-card" class="card" style="border: 2px solid var(--green);">
        <div class="card-head" style="background: var(--green-bg);">
          <span class="card-title">ğŸ¯ ã‚ãªãŸã®ä»Šæ—¥ã®ã‚¿ã‚¹ã‚¯</span>
          <span id="your-tasks-role-badge" class="biz-step-badge beginner" style="font-size: 11px;">beginner</span>
        </div>
        <div class="card-body" id="your-tasks-body">
          <!-- JSã§å‹•çš„ã«ç”Ÿæˆ -->
        </div>
      </div>

      <!-- æ¥­å‹™å…¨ä½“ãƒãƒƒãƒ— -->
      <div class="card">
        <div class="card-head">
          <span class="card-title">ğŸ—ºï¸ æ¥­å‹™å…¨ä½“ãƒãƒƒãƒ—</span>
          <span style="font-size: 11px; color: var(--muted);">è‰²ä»˜ãï¼ã‚ãªãŸã®æ‹…å½“ç¯„å›²</span>
        </div>
        <div class="card-body biz-map">
          <p class="biz-map-subtitle">ã“ã®ä»•äº‹ã¯å¤§ããã€Œ<strong>A è¨¼æ‹ åé›†</strong>ã€ã¨ã€Œ<strong>B ç”³ç«‹æ›¸ä½œæˆ</strong>ã€ã®2ã¤ã«åˆ†ã‹ã‚Œã¾ã™ã€‚<br>ã‚ãªãŸã®ãƒ­ãƒ¼ãƒ«ã«å¿œã˜ã¦ã€ã‚„ã‚‹ã¹ãã‚¹ãƒ†ãƒƒãƒ—ãŒæ®µéšçš„ã«å¢—ãˆã¦ã„ãã¾ã™ã€‚</p>

          <div class="biz-columns">
            <!-- å·¦åˆ—: A è¨¼æ‹ åé›† -->
            <div class="biz-column collect">
              <div class="biz-column-head">
                <span class="biz-column-icon">ğŸ“‚</span>
                <span class="biz-column-label">A è¨¼æ‹ åé›†</span>
              </div>
              <div class="biz-column-desc">å„æ¡ˆä»¶ï¼ˆLNï¼‰ã«å¿…è¦ãªæ›¸é¡ã‚’é›†ã‚ã‚‹ä½œæ¥­ã€‚ç°¡å˜ãªã‚‚ã®ã‹ã‚‰æ®µéšçš„ã«ã€‚</div>
              <div class="biz-step-list" id="collect-steps">
                <div class="biz-step" data-min-role="beginner" onclick="showPanel('list'); setListTab('ready');">
                  <span class="biz-step-num green">Aâ‘ </span>
                  <div class="biz-step-info">
                    <div class="biz-step-name">LNä¸€è¦§ã‚’ç¢ºèªã™ã‚‹</div>
                    <div class="biz-step-detail">ä»Šæ—¥ã‚„ã‚‹ã¹ãLNã‚’ä¸€è¦§ã‹ã‚‰è¦‹ã¤ã‘ã¦é¸ã¶</div>
                  </div>
                  <span class="biz-step-badge beginner">beginnerã€œ</span>
                </div>
                <div class="biz-step" data-min-role="beginner" onclick="openDetailOrPrompt();">
                  <span class="biz-step-num green">Aâ‘¡</span>
                  <div class="biz-step-info">
                    <div class="biz-step-name">æ›¸é¡ãƒã‚§ãƒƒã‚¯ãƒªã‚¹ãƒˆç¢ºèª</div>
                    <div class="biz-step-detail">LNè©³ç´°ç”»é¢ã§å¿…è¦æ›¸é¡ãŒæƒã£ã¦ã„ã‚‹ã‹ç¢ºèªã™ã‚‹</div>
                  </div>
                  <span class="biz-step-badge beginner">beginnerã€œ</span>
                </div>
                <div class="biz-step" data-min-role="beginner" onclick="openDetailOrPrompt();">
                  <span class="biz-step-num green">Aâ‘¢</span>
                  <div class="biz-step-info">
                    <div class="biz-step-name">CSVãƒ»Driveãƒ•ã‚©ãƒ«ãƒ€ç¢ºèª</div>
                    <div class="biz-step-detail">ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰æ¸ˆã¿ãƒ•ã‚¡ã‚¤ãƒ«ã¨ãƒ•ã‚©ãƒ«ãƒ€æ§‹æˆã‚’ãƒã‚§ãƒƒã‚¯</div>
                  </div>
                  <span class="biz-step-badge beginner">beginnerã€œ</span>
                </div>
                <div class="biz-step" data-min-role="expert" onclick="showPanel('list'); setListTab('action');">
                  <span class="biz-step-num blue">Aâ‘£</span>
                  <div class="biz-step-info">
                    <div class="biz-step-name">ä¸è¶³æ›¸é¡ã®æ‰‹é…</div>
                    <div class="biz-step-detail">å§”ä»»çŠ¶ãƒ»ä½æ°‘ç¥¨ãªã©æœªå–å¾—æ›¸é¡ã®ä¾é ¼ãƒ»å‚¬ä¿ƒ</div>
                  </div>
                  <span class="biz-step-badge expert">expertã€œ</span>
                </div>
                <div class="biz-step" data-min-role="expert" onclick="window.open('lnmanual.html?task=box','_blank');">
                  <span class="biz-step-num blue">Aâ‘¤</span>
                  <div class="biz-step-info">
                    <div class="biz-step-name">æ›¸é¡ãƒœãƒƒã‚¯ã‚¹è©°ã‚</div>
                    <div class="biz-step-detail">åé›†å®Œäº†ã—ãŸæ›¸é¡ã‚’è¦å®šã®é †ç•ªã§æ•´ç†ãƒ»æ ¼ç´</div>
                  </div>
                  <span class="biz-step-badge expert">expertã€œ</span>
                </div>
              </div>
            </div>

            <!-- å³åˆ—: B ç”³ç«‹æ›¸ä½œæˆ -->
            <div class="biz-column create">
              <div class="biz-column-head">
                <span class="biz-column-icon">ğŸ“</span>
                <span class="biz-column-label">B ç”³ç«‹æ›¸ä½œæˆ</span>
              </div>
              <div class="biz-column-desc">åé›†ã—ãŸæƒ…å ±ã‚’ã‚‚ã¨ã«ã€è£åˆ¤æ‰€ã«æå‡ºã™ã‚‹ç”³ç«‹æ›¸ã‚’ä½œæˆã™ã‚‹ä½œæ¥­ã€‚</div>
              <div class="biz-step-list" id="create-steps">
                <div class="biz-step" data-min-role="expert" onclick="showPanel('list'); setListTab('ready');">
                  <span class="biz-step-num blue">Bâ‘ </span>
                  <div class="biz-step-info">
                    <div class="biz-step-name">ç”³ç«‹æ›¸ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆåˆ©ç”¨</div>
                    <div class="biz-step-detail">ç”¨æ„ã•ã‚ŒãŸãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆã«LNæƒ…å ±ã‚’æµã—è¾¼ã‚€</div>
                  </div>
                  <span class="biz-step-badge expert">expertã€œ</span>
                </div>
                <div class="biz-step" data-min-role="expert" onclick="openDetailOrPrompt();">
                  <span class="biz-step-num blue">Bâ‘¡</span>
                  <div class="biz-step-info">
                    <div class="biz-step-name">è¨¼æ‹ èª¬æ˜æ›¸ã®ä½œæˆ</div>
                    <div class="biz-step-detail">è¨¼æ‹ ãƒªã‚¹ãƒˆã‚’æ•´ç†ã—ã€èª¬æ˜æ›¸ã‚’è‡ªå‹•ç”Ÿæˆ</div>
                  </div>
                  <span class="biz-step-badge expert">expertã€œ</span>
                </div>
                <div class="biz-step" data-min-role="leader" onclick="openDetailOrPrompt();">
                  <span class="biz-step-num purple">Bâ‘¢</span>
                  <div class="biz-step-info">
                    <div class="biz-step-name">å†…å®¹ç¢ºèªãƒ»ä¿®æ­£</div>
                    <div class="biz-step-detail">ç”Ÿæˆã•ã‚ŒãŸç”³ç«‹æ›¸ã®å†…å®¹ã‚’ç²¾æŸ»ã—ã€å¿…è¦ã«å¿œã˜ã¦ä¿®æ­£</div>
                  </div>
                  <span class="biz-step-badge leader">leader</span>
                </div>
                <div class="biz-step" data-min-role="leader" onclick="alert('ãƒ¢ãƒƒã‚¯: æœ€çµ‚æå‡ºãƒ•ãƒ­ãƒ¼');">
                  <span class="biz-step-num purple">Bâ‘£</span>
                  <div class="biz-step-info">
                    <div class="biz-step-name">æœ€çµ‚æ‰¿èªãƒ»æå‡º</div>
                    <div class="biz-step-detail">æœ€çµ‚ãƒã‚§ãƒƒã‚¯å¾Œã€è£åˆ¤æ‰€ã¸ã®æå‡ºã‚’æ‰¿èªã™ã‚‹</div>
                  </div>
                  <span class="biz-step-badge leader">leader</span>
                </div>
              </div>
            </div>
          </div>

          <!-- ãƒ­ãƒ¼ãƒ«å‡¡ä¾‹ -->
          <div class="role-legend">
            <div class="role-legend-item"><span class="role-legend-dot green"></span> beginner â€” è¨¼æ‹ åé›†ï¼ˆç°¡å˜ãªã‚‚ã®ï¼‰</div>
            <div class="role-legend-item"><span class="role-legend-dot blue"></span> expert â€” è¨¼æ‹ åé›†å…¨éƒ¨ï¼‹ç”³ç«‹æ›¸ã®ä¸€éƒ¨</div>
            <div class="role-legend-item"><span class="role-legend-dot purple"></span> leader â€” ã™ã¹ã¦ï¼‹ãƒãƒ¼ãƒ ç®¡ç†</div>
          </div>
        </div>
      </div>

      <!-- leaderå°‚ç”¨: ãƒãƒ¼ãƒ ç®¡ç† -->
      <div id="leader-team-overview" class="card" style="display: none;" data-role-only="leader">
        <div class="card-head" style="background: var(--purple-bg);">
          <span class="card-title">ğŸ‘” ãƒãƒ¼ãƒ ç®¡ç†</span>
        </div>
        <div class="card-body">
          <div class="summary-grid" style="margin-bottom: 16px;" id="expert-summary-grid">
            <div class="summary-card all" onclick="showPanel('list'); setListTab('all');"><div class="summary-label">å…¨LN</div><div class="summary-val" id="summary-all">â€”</div></div>
            <div class="summary-card ready" onclick="showPanel('list'); setListTab('ready');"><div class="summary-label">ã™ãä½œæˆå¯èƒ½</div><div class="summary-val" id="summary-ready">â€”</div></div>
            <div class="summary-card processing" onclick="showPanel('list'); setListTab('processing');"><div class="summary-label">plå‡¦ç†ä¸­</div><div class="summary-val" id="summary-processing">â€”</div></div>
            <div class="summary-card action" onclick="showPanel('list'); setListTab('action');"><div class="summary-label">è¦å¯¾å¿œ</div><div class="summary-val" id="summary-action">â€”</div></div>
          </div>
          <div style="display: flex; gap: 10px; flex-wrap: wrap;">
            <a href="#" class="btn btn-primary" onclick="showPanel('list'); setListViewMode('status'); return false;">ğŸ“‹ LNä¸€è¦§ãƒ»æ›¸é¡æŠŠæ¡<span class="element-id" title="è¦ç´ ID: P-14">P-14</span></a>
            <a href="lngame.html?panel=report" target="_blank" class="btn btn-secondary">ğŸ“Š æ—¥æ¬¡ãƒ¬ãƒãƒ¼ãƒˆ<span class="element-id" title="è¦ç´ ID: P-15">P-15</span></a>
            <a href="lngame.html?panel=leaderboard" target="_blank" class="btn btn-secondary">ğŸ† ãƒªãƒ¼ãƒ€ãƒ¼ãƒœãƒ¼ãƒ‰<span class="element-id" title="è¦ç´ ID: P-16">P-16</span></a>
            <button class="btn btn-secondary" onclick="alert('ãƒ¢ãƒƒã‚¯: æ–°è¦LNç™»éŒ²');">â• æ–°è¦LNç™»éŒ²<span class="element-id" title="è¦ç´ ID: P-17">P-17</span></button>
          </div>
        </div>
      </div>

      <!-- å®Œäº†å ±å‘Šãƒœã‚¿ãƒ³ -->
      <div class="card">
        <div class="card-body" style="display: flex; align-items: center; justify-content: space-between; padding: 16px 24px;">
          <div style="font-size: 13px; color: var(--muted);">ä»Šæ—¥ã®ä½œæ¥­ãŒçµ‚ã‚ã£ãŸã‚‰ â†’</div>
          <button type="button" class="btn btn-primary" onclick="window.open('lngame.html?panel=report&user='+currentUser.id,'_blank');">âœ… æœ¬æ—¥ã®å®Œäº†å ±å‘Š<span class="element-id" title="è¦ç´ ID: P-18">P-18</span></button>
        </div>
      </div>

    </div>

    <!-- å®Œäº†ãƒ•ãƒ­ãƒ¼ â†’ lngame.html ã«ç§»å‹• -->

    <!-- ãƒ•ã‚£ãƒ¼ãƒ‰ãƒãƒƒã‚¯ãƒ¢ãƒ¼ãƒ€ãƒ«ï¼ˆè‡ªå‹•åŒ–ã§ããªã„ã“ã¨ï¼‰ -->
    <div id="feedback-modal" style="display: none; position: fixed; inset: 0; background: rgba(0,0,0,0.4); z-index: 100; align-items: center; justify-content: center; padding: 24px;">
      <div class="card" style="max-width: 480px; width: 100%; box-shadow: 0 8px 32px rgba(0,0,0,0.2);">
        <div class="card-head" style="background: var(--yellow-bg);">
          <span class="card-title">âš ï¸ è‡ªå‹•åŒ–ã§ããªã„ã“ã¨ â€” ãƒ•ã‚£ãƒ¼ãƒ‰ãƒãƒƒã‚¯</span>
          <button type="button" onclick="closeFeedbackModal()" style="background: none; border: none; font-size: 18px; cursor: pointer; padding: 0; line-height: 1;">Ã—</button>
        </div>
        <div class="card-body">
          <p style="font-size: 12px; color: var(--muted); margin-bottom: 12px;">è‡ªå‹•åŒ–ã§ããªã‹ã£ãŸé …ç›®ã‚„ã€æ‰‹å‹•å¯¾å¿œãŒå¿…è¦ãªå†…å®¹ã‚’è¨˜è¼‰ã—ã¦ãã ã•ã„ã€‚</p>
          <textarea id="feedback-textarea" placeholder="ä¾‹ï¼šplãŒ3ä»¶å‡¦ç†ä¸­ã®ã¾ã¾ã€‚ãƒãƒƒã‚·ãƒ¥ä¸ä¸€è‡´ã®ãŸã‚æ‰‹å‹•ç¢ºèªãŒå¿…è¦ã€‚&#10;ä¾‹ï¼šå§”ä»»çŠ¶ãŒæœªåé›†ã€‚ç”³ç«‹äººã«ä¾é ¼ä¸­ã€‚" style="width: 100%; min-height: 120px; padding: 12px; border: 1px solid var(--border); border-radius: 8px; font-size: 13px; resize: vertical; font-family: inherit;" rows="5"></textarea>
          <div style="margin-top: 16px; display: flex; gap: 10px;">
            <button type="button" class="btn btn-primary" onclick="submitFeedback()">é€ä¿¡</button>
            <button type="button" class="btn btn-secondary" onclick="closeFeedbackModal()">ã‚­ãƒ£ãƒ³ã‚»ãƒ«</button>
          </div>
        </div>
      </div>
    </div>


    <!-- ========== LNä¸€è¦§ãƒ»çŠ¶æ³ï¼ˆçµ±åˆï¼‰ ========== -->
    <div id="panel-list" class="panel">
      <div class="action-bar">
        <button class="btn btn-primary" onclick="showPanel('top')">â† ãƒ›ãƒ¼ãƒ </button>
        <span id="list-role-hint" style="font-size: 12px; color: var(--muted); align-self: center;"></span>
      </div>
      <!-- è¡¨ç¤ºãƒ¢ãƒ¼ãƒ‰åˆ‡æ›¿ -->
      <div class="ln-view-mode-tabs" style="display: flex; gap: 4px; margin-bottom: 16px;">
        <button class="ln-view-mode-tab active" data-view="list" onclick="setListViewMode('list')">ğŸ“„ ä¸€è¦§<span class="element-id" title="è¦ç´ ID: P-20">P-20</span></button>
        <button class="ln-view-mode-tab" data-view="status" onclick="setListViewMode('status')">ğŸ“‹ æ›¸é¡æŠŠæ¡<span class="element-id" title="è¦ç´ ID: P-21">P-21</span></button>
      </div>

      <!-- ä¸€è¦§è¡¨ç¤º -->
      <div id="ln-view-list" class="ln-view-content">
        <div class="tabs" role="tablist">
          <button class="tab" data-tab="all" onclick="setListTab('all')" title="å…¨LNã‚’è¡¨ç¤º">å…¨LN <span class="count">13ä»¶</span><span class="element-id" title="è¦ç´ ID: P-22">P-22</span></button>
          <button class="tab" data-tab="ready" onclick="setListTab('ready')" title="ç”³ç«‹æ›¸ä½œæˆã®æº–å‚™ãŒã§ãã¦ã„ã‚‹LNï¼ˆbeginnerã¯ã“ã‚Œï¼‰">ä»Šæ—¥ã‚„ã‚‹ã“ã¨ <span class="count">8ä»¶</span><span class="element-id" title="è¦ç´ ID: P-23">P-23</span></button>
          <button class="tab" data-tab="action" onclick="setListTab('action')" title="ç›®çš„: å§”ä»»çŠ¶å¾…ã¡ãƒ»ä»£è¡¨è€…äº‹é …è¨¼æ˜æ›¸å¾…ã¡ãªã©å¯¾å¿œãŒå¿…è¦ãªLN">è¦å¯¾å¿œ <span class="count">5ä»¶</span><span class="element-id" title="è¦ç´ ID: P-24">P-24</span></button>
          <button class="tab" data-tab="processing" onclick="setListTab('processing')" title="ç›®çš„: plï¼ˆPDFç”Ÿæˆï¼‰å‡¦ç†ä¸­ã®LN">plå‡¦ç†ä¸­ <span class="count">0ä»¶</span><span class="element-id" title="è¦ç´ ID: P-25">P-25</span></button>
        </div>
        <div class="search-row">
          <input type="text" class="search-input" placeholder="è¨´ç•ªãƒ»ç”³ç«‹äººãƒ»ç›¸æ‰‹æ–¹ã§æ¤œç´¢..." id="ln-search">
          <button class="btn btn-secondary" onclick="filterLnList()">æ¤œç´¢</button>
        </div>

        <div class="card">
          <div class="card-head">
            <span class="card-title">LNä¸€è¦§</span>
            <span style="font-size: 12px; color: var(--muted);" id="ln-list-count">å…¨13ä»¶</span>
          </div>
          <div class="card-body" style="padding: 0;" id="ln-list-body">
          <!-- Dynamically rendered by renderLnList() -->
        </div>
      </div>
      </div>

      <!-- æ›¸é¡æŠŠæ¡è¡¨ç¤º -->
      <div id="ln-view-status" class="ln-view-content" style="display: none;">
        <div class="card">
          <div class="card-head" style="background: var(--purple-bg);">
            <span class="card-title">ğŸ“‹ æ›¸é¡æŠŠæ¡</span>
            <span style="font-size: 12px; color: var(--muted);">å§”ä»»çŠ¶ãƒ»KKãŒæƒã£ãŸLNã‹ã‚‰ç”³ç«‹æ›¸ä½œæˆã‚’é€²ã‚ã‚‹</span>
          </div>
          <div class="card-body">
            <div style="background: var(--yellow-bg); border: 1px solid var(--yellow); border-radius: 8px; padding: 12px 16px; margin-bottom: 16px; font-size: 12px;">
              <strong>é€²ã‚æ–¹ï¼š</strong> å§”ä»»çŠ¶ã¨KKãŒæƒã£ãŸLNï¼ˆA è¨¼æ‹ åé›†å®Œäº†ï¼‰ã‹ã‚‰B ç”³ç«‹æ›¸ä½œæˆã‚’é€²ã‚ã¾ã™ã€‚ãã‚Œã¾ã§ã¯å§”ä»»çŠ¶ãƒ»KKåé›†ã«é›†ä¸­ã—ã¦ãã ã•ã„ã€‚
            </div>
            <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:16px;flex-wrap:wrap;gap:12px">
              <div class="ln-status-tabs">
                <button class="ln-status-tab active" data-ln-status-filter="all" onclick="setLnStatusFilter('all')">å…¨ä»¶<span class="element-id" title="è¦ç´ ID: P-26">P-26</span></button>
                <button class="ln-status-tab" data-ln-status-filter="go" onclick="setLnStatusFilter('go')">âœ… å§”ä»»çŠ¶ãƒ»KKæƒã„ï¼ˆé€²ã‚ã‚‹ï¼‰<span class="element-id" title="è¦ç´ ID: P-27">P-27</span></button>
                <button class="ln-status-tab" data-ln-status-filter="collect" onclick="setLnStatusFilter('collect')">â³ å§”ä»»çŠ¶ãƒ»KKåé›†ä¸­<span class="element-id" title="è¦ç´ ID: P-28">P-28</span></button>
              </div>
              <button onclick="generateRequestText()" style="padding:8px 16px;background:linear-gradient(135deg,#3b82f6 0%,#2563eb 100%);color:#fff;border:none;border-radius:8px;font-size:13px;font-weight:600;cursor:pointer;box-shadow:0 2px 8px rgba(59,130,246,0.3);transition:all 0.2s" onmouseover="this.style.transform='translateY(-1px)';this.style.boxShadow='0 4px 12px rgba(59,130,246,0.4)'" onmouseout="this.style.transform='';this.style.boxShadow='0 2px 8px rgba(59,130,246,0.3)'">
                ğŸ“‹ ã¾ã¨ã‚ã¦ä½œæˆä¾é ¼<span class="element-id" style="background:#fff;color:#3b82f6" title="è¦ç´ ID: P-29">P-29</span>
              </button>
            </div>
            <div style="overflow-x: auto;">
              <table class="ln-status-table" id="ln-status-table">
                <thead>
                  <tr>
                    <th>LN</th>
                    <th>ç”³ç«‹äºº/ç›¸æ‰‹æ–¹</th>
                    <th>å§”ä»»çŠ¶</th>
                    <th>KK<br><small>DBè¨˜éŒ²å°åˆ·æ›¸é¢</small></th>
                    <th>è¨¼æ‹ ç”¨USB</th>
                    <th>ä»£è¡¨è€…äº‹é …</th>
                    <th>çŠ¶æ³</th>
                  </tr>
                </thead>
                <tbody id="ln-status-body"><!-- å‹•çš„ç”Ÿæˆ --></tbody>
              </table>
            </div>
          </div>
        </div>
      </div>
    </div>


    <!-- ========== ç”³ç«‹æ›¸ãƒ†ãƒ³ãƒ—ãƒ¬é›† ========== -->
    <div id="panel-templates" class="panel">
      <div class="guide-box">
        <h3>ğŸ“ ç”³ç«‹æ›¸ãƒ†ãƒ³ãƒ—ãƒ¬é›† â€” ã€Œï¼ˆï¼‘ï¼‰ç”³ç«‹äººãŒæœ¬ä»¶è‘—ä½œç‰©ã®è‘—ä½œæ¨©è€…ã§ã‚ã‚‹ã“ã¨ã€ã®ç·¨é›†ç”¨</h3>
        <p>ç”³ç«‹æ›¸ã®è‘—ä½œæ¨©è€…ç«‹è¨¼éƒ¨åˆ†ã®ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆã€‚CPï¼ˆãƒ¡ãƒ¼ã‚«ãƒ¼ï¼‰ãƒ»ãƒ‘ã‚¿ãƒ¼ãƒ³ã«å¿œã˜ã¦é¸æŠã—ã€â—éƒ¨åˆ†ã‚’ç·¨é›†ã—ã¦ä½¿ç”¨ã€‚</p>
        <p style="font-size: 11px; color: var(--muted); margin-top: 8px;">â€»ã“ã®HTMLå˜ä½“ã§å‹•ä½œã—ã¾ã™ï¼ˆå¤–éƒ¨ãƒ•ã‚¡ã‚¤ãƒ«ä¸è¦ï¼‰</p>
      </div>
      <div class="action-bar">
        <button class="btn btn-primary" onclick="showPanel('list')">â† LNä¸€è¦§ã«æˆ»ã‚‹</button>
      </div>

      <!-- ç”³ç«‹æ›¸ç¨®é¡ã¨å¿…è¦ãªåˆ¥ç´™ -->
      <div class="card" style="margin-bottom: 20px;">
        <div class="card-head">
          <span class="card-title">ğŸ“Œ ç”³ç«‹æ›¸ã®ç¨®é¡ï¼ˆã©ã‚Œã‹é¸ã¶ï¼‰</span>
        </div>
        <div class="card-body">
          <label for="doc-type-select" style="display: block; font-size: 12px; font-weight: 600; margin-bottom: 8px;">ç”³ç«‹æ›¸ã®ç¨®é¡</label>
          <select id="doc-type-select" onchange="setDocType(this.value)" style="width: 100%; max-width: 480px; padding: 10px 14px; font-size: 13px; border-radius: 8px; border: 1px solid var(--border); background: var(--surface); margin-bottom: 12px;">
            <option value="open">ç™ºä¿¡è€…æƒ…å ±é–‹ç¤ºå‘½ä»¤æ›¸</option>
            <option value="delete">ç™ºä¿¡è€…æƒ…å ±é–‹ç¤ºå‘½ä»¤æ›¸å…¼æ¶ˆå»ç¦æ­¢å‘½ä»¤ç”³ç«‹æ›¸</option>
            <option value="provide">ç™ºä¿¡è€…æƒ…å ±é–‹ç¤ºå‘½ä»¤æ›¸å…¼æä¾›å‘½ä»¤ç”³ç«‹æ›¸</option>
          </select>
          <div id="doc-type-desc" style="font-size: 12px; color: var(--muted); line-height: 1.7; padding: 12px; background: var(--surface2); border-radius: 8px;">
            <strong>ç™ºä¿¡è€…æƒ…å ±é–‹ç¤ºå‘½ä»¤æ›¸</strong> â€” é–‹ç¤ºè«‹æ±‚ã®ã¿ã€‚å¿…è¦åˆ¥ç´™: å½“äº‹è€…ç›®éŒ²ã€è‘—ä½œç‰©ç›®éŒ²ã€å‹•ç”»ç›®éŒ²ã€ç™ºä¿¡è€…æƒ…å ±ç›®éŒ²ï¼ˆï¼‘ï¼‰ã€‚
          </div>
        </div>
      </div>

      <!-- ç”³ç«‹æ›¸ å…¨ä½“æ§‹æˆã‚µãƒ³ãƒ—ãƒ« -->
      <div class="card" style="margin-bottom: 20px;">
        <div class="card-head">
          <span class="card-title">ğŸ“‹ ç”³ç«‹æ›¸ å…¨ä½“æ§‹æˆã‚µãƒ³ãƒ—ãƒ«</span>
        </div>
        <div class="card-body">
          <div style="display: flex; gap: 16px; flex-wrap: wrap; margin-bottom: 12px;">
            <label style="display: flex; align-items: center; gap: 6px; font-size: 12px;">
              <span>ç¨®é¡:</span>
              <select id="full-doc-type" onchange="updateFullDocSample()" style="padding: 6px 10px; font-size: 12px; border-radius: 6px;">
                <option value="open">ç™ºä¿¡è€…æƒ…å ±é–‹ç¤ºå‘½ä»¤æ›¸</option>
                <option value="delete">é–‹ç¤ºï¼‹æ¶ˆå»ç¦æ­¢</option>
                <option value="provide">é–‹ç¤ºï¼‹æä¾›å‘½ä»¤</option>
              </select>
            </label>
            <label style="display: flex; align-items: center; gap: 6px; font-size: 12px;">
              <span>è‘—ä½œæ¨©è€…ç«‹è¨¼:</span>
              <select id="copyright-proof" onchange="updateFullDocSample()" style="padding: 6px 10px; font-size: 12px; border-radius: 6px;">
                <option value="kantoku">ç›£ç£ã‚ã‚Š</option>
                <option value="mukantoku">ç›£ç£ãªã—</option>
              </select>
            </label>
          </div>
          <div id="full-doc-sample" class="template-body" style="font-size: 10px; line-height: 1.7; max-height: 500px; overflow-y: auto; white-space: pre-wrap; font-family: 'Hiragino Mincho ProN', 'Yu Mincho', serif;"></div>
        </div>
      </div>

      <!-- CPåˆ¥ãƒ†ãƒ³ãƒ—ãƒ¬æ—©è¦‹è¡¨ -->
      <div class="card" style="margin-bottom: 20px;">
        <div class="card-head">
          <span class="card-title">CPåˆ¥ãƒ†ãƒ³ãƒ—ãƒ¬æ—©è¦‹</span>
        </div>
        <div class="card-body" style="font-size: 11px;">
          <div style="display: grid; grid-template-columns: repeat(auto-fill, minmax(140px, 1fr)); gap: 8px;">
            <span><strong>ãƒŠãƒãƒ¥</strong> â†’ â‘ ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ or ãƒŠãƒãƒ¥åˆ†å‰²è²©å£²</span>
            <span><strong>CONT</strong> â†’ â‘¡ç¢ºèªæ›¸ or Contè¤‡æ•°ç›£ç£</span>
            <span><strong>ã‚­ãƒ³ã‚°ãƒ€ãƒ </strong> â†’ â‘¡ç¢ºèªæ›¸</span>
            <span><strong>MBM</strong> â†’ MBMï¼ˆè·å‹™è‘—ä½œï¼‰</span>
            <span><strong>hmp</strong> â†’ hmp1 or hmp2</span>
            <span><strong>ãƒ™ãƒ³ãƒãƒ¼</strong> â†’ ãƒ™ãƒ³ãƒãƒ¼å…¬å¼/è­²æ¸¡</span>
            <span><strong>ãƒ—ãƒ¬ã‚¹ãƒ†ãƒ¼ã‚¸</strong> â†’ ãƒ—ãƒ¬ã‚¹ãƒ†ãƒ¼ã‚¸å•†å·ãƒ»å•†æ¨™</span>
            <span><strong>ç›£ç£ãªã—</strong> â†’ â‘ ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ï¼ˆè‘—ä½œè¡¨è¨˜ï¼‰</span>
            <span><strong>ç›£ç£ã‚ã‚Š</strong> â†’ â‘¡ç¢ºèªæ›¸ç³»</span>
          </div>
        </div>
      </div>

      <!-- ãƒ—ãƒ«ãƒ€ã‚¦ãƒ³ã§ãƒ†ãƒ³ãƒ—ãƒ¬é¸æŠ -->
      <div class="card" style="margin-bottom: 20px;">
        <div class="card-head">
          <span class="card-title">ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆã‚’é¸æŠ</span>
        </div>
        <div class="card-body">
          <label for="template-select" style="display: block; font-size: 12px; font-weight: 600; margin-bottom: 8px;">ï¼ˆï¼‘ï¼‰ç”³ç«‹äººãŒæœ¬ä»¶è‘—ä½œç‰©ã®è‘—ä½œæ¨©è€…ã§ã‚ã‚‹ã“ã¨ â€” ç·¨é›†ç”¨ãƒ†ãƒ³ãƒ—ãƒ¬</label>
          <select id="template-select" onchange="showTemplate(this.value)" style="width: 100%; max-width: 480px; padding: 10px 14px; font-size: 13px; border-radius: 8px; border: 1px solid var(--border); background: var(--surface);">
            <option value="">â€” é¸æŠã—ã¦ãã ã•ã„ â€”</option>
            <optgroup label="â‘ ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ç³»">
              <option value="pkg1">â‘ ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã«è‘—ä½œè¡¨è¨˜ãŒã‚ã‚‹ãƒ‘ã‚¿ãƒ¼ãƒ³ï¼ˆãƒŠãƒãƒ¥ç­‰ï¼‰</option>
              <option value="nacha-split">ãƒŠãƒãƒ¥ï¼ˆåˆ†å‰²è²©å£²åˆ†ï¼‰</option>
            </optgroup>
            <optgroup label="â‘¡ç¢ºèªæ›¸ç³»">
              <option value="confirm2">â‘¡è²©å£²ã‚µã‚¤ãƒˆï¼‹ç¢ºèªæ›¸ï¼ˆè¤‡æ•°ç›£ç£ï¼‰</option>
              <option value="confirm2b">â‘¡ã®ï¼’ åŒäººã«å¤‰ãˆãŸç›£ç£ãƒ‘ã‚¿ãƒ¼ãƒ³</option>
              <option value="kadachiyama">è§’åœ°å±±å…ˆç”Ÿã®ç¢ºèªæ›¸ï¼ˆè¤‡æ•°ï¼‰</option>
              <option value="generic">æ±ç”¨ç¢ºèªæ›¸ãƒ‘ã‚¿ãƒ¼ãƒ³ï¼ˆç”²14é …ç›®å‰Šé™¤ç‰ˆï¼‰</option>
            </optgroup>
            <optgroup label="æ²³ç”°å…ˆç”Ÿæå‡ºç”¨">
              <option value="groove">ã‚°ãƒ«ãƒ¼ãƒ´ãƒ»ãƒ©ãƒœ</option>
              <option value="cont-kawata">Contï¼ˆæ²³ç”°å…ˆç”Ÿç‰ˆï¼‰</option>
              <option value="hohohosha">æ–¹ã€…ç¤¾ï¼ˆæ²³ç”°å…ˆç”Ÿç‰ˆï¼‰</option>
              <option value="horizon">Horizonï¼ˆæ²³ç”°å…ˆç”Ÿä¿®æ­£ãƒ»ç¤¾é•·ç¢ºèªæ›¸ï¼‰</option>
            </optgroup>
            <optgroup label="MBMãƒ»hmp">
              <option value="mbm">MBMï¼ˆæ²³ç”°å…ˆç”Ÿä¿®æ­£ç‰ˆãƒ»è·å‹™è‘—ä½œï¼‰</option>
              <option value="hmp1">hmp1ï¼ˆè£½ä½œãƒ»ç™ºå£²ãƒ»è²©å£²è¡¨è¨˜ï¼‰</option>
              <option value="hmp2">hmp2ï¼ˆè¤‡åˆç‰ˆãƒ»å¤§å¡šå…ˆç”Ÿç·¨é›†ï¼‰</option>
            </optgroup>
            <optgroup label="ãƒ™ãƒ³ãƒãƒ¼">
              <option value="benhur-transfer">ãƒ™ãƒ³ãƒãƒ¼ï¼ˆè­²æ¸¡å¥‘ç´„æ›¸ãƒ»æœ€è¿‘ã¯åŸºæœ¬ä½¿ã‚ãªã„ï¼‰</option>
              <option value="benhur2">ãƒ™ãƒ³ãƒãƒ¼ï¼’ï¼ˆæ²³ç”°å…ˆç”Ÿä»¥å¤–ã¯ã“ã£ã¡ã§ã‚‚OKï¼‰</option>
              <option value="benhur-kawata">ãƒ™ãƒ³ãƒãƒ¼ï¼ˆæ²³ç”°å…ˆç”Ÿä¿®æ­£ç‰ˆãƒ»å…¬å¼ã‚µã‚¤ãƒˆï¼‰</option>
            </optgroup>
            <optgroup label="ãƒ—ãƒ¬ã‚¹ãƒ†ãƒ¼ã‚¸ãƒ»ãƒ›ãƒƒãƒˆ">
              <option value="prestige1">ãƒ—ãƒ¬ã‚¹ãƒ†ãƒ¼ã‚¸ï¼ˆå•†å·ãƒ»å•†æ¨™ï¼‰</option>
              <option value="prestige2">ãƒ—ãƒ¬ã‚¹ãƒ†ãƒ¼ã‚¸ï¼’ï¼ˆæ²³ç”°å…ˆç”Ÿä¿®æ­£ç‰ˆï¼‰</option>
              <option value="hot">ãƒ›ãƒƒãƒˆã‚¨ãƒ³ã‚¿ãƒ¼ãƒ†ã‚¤ãƒ¡ãƒ³ãƒˆ</option>
            </optgroup>
            <optgroup label="Contãƒ»ãƒ–ãƒ«ãƒ¼ã‚³ãƒ¼ãƒŠãƒ¼ãƒ»ãã®ä»–CP">
              <option value="cont-multi">Contï¼ˆåŒä¸€ä½œå“ã«è¤‡æ•°ç›£ç£ï¼‰</option>
              <option value="blue-normal">ãƒ–ãƒ«ãƒ¼ã‚³ãƒ¼ãƒŠãƒ¼ï¼ˆé€šå¸¸ç‰ˆï¼‰</option>
              <option value="blue-kawata">ãƒ–ãƒ«ãƒ¼ã‚³ãƒ¼ãƒŠãƒ¼ï¼ˆæ²³ç”°å…ˆç”Ÿä¿®æ­£ç‰ˆï¼‰</option>
              <option value="mka">ã‚¨ãƒ ã‚±ã‚¤ã‚¨ã‚¤ãƒ</option>
              <option value="kspro">KSãƒ—ãƒ­</option>
            </optgroup>
            <optgroup label="è¨¼æ‹ èª¬æ˜æ›¸ï¼ˆç”²å·è¨¼ï¼‰">
              <option value="ev-standard">è¨¼æ‹ èª¬æ˜æ›¸ï¼ˆæ¨™æº–æ§‹æˆï¼‰</option>
              <option value="ev-mbm">MBM è¨¼æ‹ èª¬æ˜æ›¸</option>
              <option value="ev-hot">ãƒ›ãƒƒãƒˆã‚¨ãƒ³ã‚¿ãƒ¼ãƒ†ã‚¤ãƒ¡ãƒ³ãƒˆ è¨¼æ‹ èª¬æ˜æ›¸</option>
              <option value="ev-multi">è¤‡æ•°å“ç•ªã®è¨¼æ‹ èª¬æ˜æ›¸ç”¨</option>
              <option value="ev-benhur">ãƒ™ãƒ³ãƒãƒ¼ï¼ˆè­²æ¸¡å¥‘ç´„æ›¸ã®å ´åˆï¼‰è¨¼æ‹ </option>
              <option value="ev-trademark">å•†æ¨™ã‚’ä½¿ã†å ´åˆï¼ˆãƒ—ãƒ¬ã‚¹ãƒ†ãƒ¼ã‚¸ç­‰ï¼‰</option>
              <option value="ev-kmp">KMPãƒ»åˆæ„ç· çµè¨¼æ˜æ›¸ã‚»ãƒƒãƒˆ</option>
              <option value="ev-kawata">æ²³ç”°å…ˆç”Ÿ ç¢ºèªæ›¸ãƒ‘ã‚¿ãƒ¼ãƒ³è¨¼æ‹ ï¼ˆç”²14ã®ï¼‘ãƒ»ï¼’ï¼‰</option>
              <option value="ev-hohohosha">æ–¹ã€…ç¤¾ è¨¼æ‹ èª¬æ˜æ›¸</option>
              <option value="ev-blue">ãƒ–ãƒ«ãƒ¼ã‚³ãƒ¼ãƒŠãƒ¼ è¨¼æ‹ èª¬æ˜æ›¸</option>
              <option value="ev-nacha">ãƒŠãƒãƒ¥ï¼ˆåˆ†å‰²è²©å£²ï¼‰è¨¼æ‹ èª¬æ˜æ›¸</option>
              <option value="ev-mka">ã‚¨ãƒ ã‚±ã‚¤ã‚¨ã‚¤ãƒ è¨¼æ‹ èª¬æ˜æ›¸</option>
              <option value="ev-kspro">KSãƒ—ãƒ­ è¨¼æ‹ èª¬æ˜æ›¸</option>
            </optgroup>
          </select>
          <div id="template-preview" class="template-body" style="margin-top: 16px; min-height: 80px; white-space: pre-wrap; font-family: 'Hiragino Mincho ProN', 'Yu Mincho', serif; font-size: 11px; line-height: 1.8; padding: 14px 18px; background: var(--surface2); border: 1px solid var(--border); border-radius: 8px; max-height: 400px; overflow-y: auto; color: var(--muted);">ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆã‚’é¸æŠã™ã‚‹ã¨ã“ã“ã«è¡¨ç¤ºã•ã‚Œã¾ã™ã€‚â—éƒ¨åˆ†ã‚’ç·¨é›†ã—ã¦ä½¿ç”¨ã—ã¦ãã ã•ã„ã€‚</div>
        </div>
      </div>
    </div>

    <!-- æ—¥æ¬¡ãƒ¬ãƒãƒ¼ãƒˆ â†’ lngame.html ã«ç§»å‹• -->

    <!-- ãƒªãƒ¼ãƒ€ãƒ¼ãƒœãƒ¼ãƒ‰ â†’ lngame.html ã«ç§»å‹• -->

  </main>
    </div>
  </div>

  <script src="db_case.js"></script>
  <!-- db_game.js â†’ lngame.html ã®ã¿ãŒèª­ã¿è¾¼ã¿ -->
  <script>
    let currentListTab = 'all';
    // USERS ã¯ db_case.js ã§å®šç¾©æ¸ˆã¿ï¼ˆã‚²ãƒ¼ãƒ ãƒ‡ãƒ¼ã‚¿ã¯lngame.htmlå´ã§åˆæˆï¼‰
    let currentUser = USERS[0];
    let currentRole = 'beginner';



    // ã‚²ãƒ¼ãƒ é–¢é€£é–¢æ•°ï¼ˆgetLevelInfo, renderPromotionCard, renderLevelBar ç­‰ï¼‰ â†’ lngame.html ã«ç§»å‹•

    // ä½œæ¥­ãƒ­ã‚°ã¯ db_case.js ã® actionLog ã§å®šç¾©æ¸ˆã¿

        // LN_STATUS_DATA ã¯ db_case.js ã§å®šç¾©æ¸ˆã¿

// markTaskDone â†’ lngame.html ã«ç§»å‹•

    // showCompletionFlow â†’ lngame.html ã«ç§»å‹•

    const FEEDBACK_STORAGE_KEY = 'ln-portal-feedback';
    function getStoredFeedback() {
      try {
        const raw = localStorage.getItem(FEEDBACK_STORAGE_KEY);
        return raw ? JSON.parse(raw) : [];
      } catch (_) { return []; }
    }
    function saveFeedback(arr) {
      try { localStorage.setItem(FEEDBACK_STORAGE_KEY, JSON.stringify(arr)); } catch (_) {}
    }
    function renderFeedbackLog() {
      const el = document.getElementById('feedback-log');
      if (!el) return;
      const list = getStoredFeedback();
      if (list.length === 0) {
        el.innerHTML = '<span style="color: var(--faint);">æ›¸ã„ãŸãƒ•ã‚£ãƒ¼ãƒ‰ãƒãƒƒã‚¯ã¯ã“ã“ã«è¡¨ç¤ºã•ã‚Œã¾ã™</span>';
        return;
      }
      el.innerHTML = list.slice(-10).reverse().map((f, i) => {
        const ln = f.ln ? '[' + f.ln + '] ' : '';
        const at = f.at ? new Date(f.at).toLocaleString('ja-JP', { month: 'numeric', day: 'numeric', hour: '2-digit', minute: '2-digit' }) : '';
        return '<div style="margin-bottom: 6px; padding: 6px 8px; background: var(--surface2); border-radius: 6px; font-size: 10px;"><span style="color: var(--muted);">' + at + (ln ? ' ' + ln : '') + '</span><br>' + (f.text || '').substring(0, 80) + ((f.text || '').length > 80 ? 'â€¦' : '') + '</div>';
      }).join('');
    }

    function openFeedbackModal() {
      const modal = document.getElementById('feedback-modal');
      const ta = document.getElementById('feedback-textarea');
      if (!modal || !ta) return;
      ta.value = currentDetailLn ? '[' + currentDetailLn + '] ' : '';
      modal.style.display = 'flex';
      ta.focus();
    }

    function closeFeedbackModal() {
      const modal = document.getElementById('feedback-modal');
      if (modal) modal.style.display = 'none';
    }

    function submitFeedback() {
      const ta = document.getElementById('feedback-textarea');
      if (!ta) return;
      const text = (ta.value || '').trim();
      if (!text) {
        alert('ãƒ•ã‚£ãƒ¼ãƒ‰ãƒãƒƒã‚¯ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„ã€‚');
        return;
      }
      const list = getStoredFeedback();
      list.push({
        text: text,
        ln: currentDetailLn || null,
        at: new Date().toISOString(),
        user: currentUser?.name || null
      });
      saveFeedback(list);
      renderFeedbackLog();
      ta.value = '';
      closeFeedbackModal();
      alert('ãƒ•ã‚£ãƒ¼ãƒ‰ãƒãƒƒã‚¯ã‚’ä¿å­˜ã—ã¾ã—ãŸã€‚');
    }

    let currentDetailLn = '';

    function openDetailOrPrompt() {
      // panel-detail å‰Šé™¤æ¸ˆã¿ â€” LNä¸€è¦§ã«ç›´æ¥é·ç§»
      showPanel('list');
      setListTab('ready');
    }

    function markLnCheckDone() {
      const ln = currentDetailLn || 'â€”';
      alert('âœ… LNç¢ºèªå®Œäº†: ' + ln);
    }




    // updateLeaderboardPanel â†’ lngame.html ã«ç§»å‹•


    // updateReportPanel â†’ lngame.html ã«ç§»å‹•

    // ãƒ­ãƒ¼ãƒ«éšå±¤: beginner < expert < leader
    const ROLE_LEVEL = { beginner: 0, expert: 1, leader: 2 };

    function applyRoleView() {
      const roleLabel = { beginner: 'beginner', expert: 'expert', leader: 'leader' };
      const roleColor = { beginner: 'var(--green)', expert: 'var(--blue)', leader: 'var(--purple)' };
      const roleBg = { beginner: 'var(--green-bg)', expert: 'var(--blue-bg)', leader: 'var(--purple-bg)' };
      const roleDesc = {
        beginner: 'æ›¸é¡é›†ã‚ã®åŸºæœ¬ä½œæ¥­ï¼ˆLNç¢ºèªãƒ»ãƒã‚§ãƒƒã‚¯ãƒªã‚¹ãƒˆãƒ»ãƒ•ã‚©ãƒ«ãƒ€ç¢ºèªï¼‰ã‚’æ‹…å½“ã—ã¾ã™',
        expert: 'æ›¸é¡é›†ã‚å…¨èˆ¬ï¼‹ç”³ç«‹æ›¸ãƒ†ãƒ³ãƒ—ãƒ¬åˆ©ç”¨ãƒ»è¨¼æ‹ èª¬æ˜æ›¸ä½œæˆã‚’æ‹…å½“ã—ã¾ã™',
        leader: 'å…¨æ¥­å‹™ï¼‹ç”³ç«‹æ›¸ã®æœ€çµ‚ç¢ºèªãƒ»æ‰¿èªãƒ»ãƒãƒ¼ãƒ ç®¡ç†ã‚’æ‹…å½“ã—ã¾ã™'
      };

      // ã‚¦ã‚§ãƒ«ã‚«ãƒ 
      const wn = document.getElementById('welcome-name');
      const wr = document.getElementById('welcome-role');
      const wd = document.getElementById('welcome-desc');
      if (wn) wn.textContent = currentUser.name + ' ã•ã‚“';
      if (wr) {
        wr.textContent = roleLabel[currentRole];
        wr.style.color = roleColor[currentRole];
        wr.style.background = roleBg[currentRole];
      }
      if (wd) wd.textContent = roleDesc[currentRole] || '';

      // data-role-only å±æ€§ã§è¡¨ç¤ºåˆ¶å¾¡
      document.querySelectorAll('[data-role-only]').forEach(el => {
        const roles = (el.dataset.roleOnly || '').split(',').map(s => s.trim());
        el.style.display = roles.includes(currentRole) ? '' : 'none';
      });

      // æ¥­å‹™ãƒãƒƒãƒ—ã®ã‚¹ãƒ†ãƒƒãƒ—: ãƒ­ãƒ¼ãƒ«æœªæº€ã¯ locked
      const myLevel = ROLE_LEVEL[currentRole] || 0;
      document.querySelectorAll('.biz-step[data-min-role]').forEach(el => {
        const minLevel = ROLE_LEVEL[el.dataset.minRole] || 0;
        if (minLevel > myLevel) {
          el.classList.add('locked');
        } else {
          el.classList.remove('locked');
        }
      });

      // ã€Œã‚ãªãŸã®ä»Šæ—¥ã®ã‚¿ã‚¹ã‚¯ã€ã‚«ãƒ¼ãƒ‰ç”Ÿæˆ
      updateYourTasks();

      // ã€Œã‚ãªãŸã®ä»Šæ—¥ã®ã‚¿ã‚¹ã‚¯ã€ã‚«ãƒ¼ãƒ‰ã®ã‚¹ã‚¿ã‚¤ãƒ«ã‚’ãƒ­ãƒ¼ãƒ«ã«åˆã‚ã›ã‚‹
      const ytCard = document.getElementById('your-tasks-card');
      const ytBadge = document.getElementById('your-tasks-role-badge');
      if (ytCard) {
        ytCard.style.borderColor = roleColor[currentRole];
      }
      if (ytBadge) {
        ytBadge.className = 'biz-step-badge ' + currentRole;
        ytBadge.style.fontSize = '11px';
        ytBadge.textContent = roleLabel[currentRole];
      }

      // LNä¸€è¦§ã‚¬ã‚¤ãƒ‰
      const lgb = document.getElementById('list-guide-box');
      const lrh = document.getElementById('list-role-hint');
      if (lgb) lgb.innerHTML = currentRole === 'beginner' ? '<strong>ä½œæ¥­:</strong> æº–å‚™å®Œäº†ã®LNã‚’ç¢ºèª â†’ å•é¡Œãªã‘ã‚Œã°å ±å‘Š' : '<strong>ä½œæ¥­:</strong> LNä¸€è¦§ã‹ã‚‰å¯¾è±¡ã‚’é¸æŠã—ã¦å¯¾å¿œ';
      if (lrh) lrh.innerHTML = currentRole === 'beginner' ? 'ğŸ’¡ ã€Œä»Šæ—¥ã‚„ã‚‹ã“ã¨ã€ã‚¿ãƒ–ã§ã€ã‚ãªãŸã®ä½œæ¥­ãŒè¦‹ã¤ã‹ã‚Šã¾ã™' : 'ğŸ’¡ å…¨ã‚¿ãƒ–è¡¨ç¤ºã€‚ãƒ•ã‚£ãƒ«ã‚¿ã§åŠ¹ç‡ã‚ˆãæ¢ã›ã¾ã™';
    }

    function updateYourTasks() {
      const body = document.getElementById('your-tasks-body');
      if (!body) return;
      const tasks = [];
      if (currentRole === 'beginner') {
        tasks.push(
          { icon: '1ï¸âƒ£', name: 'Aâ‘  LNä¸€è¦§ã‚’ç¢ºèªã™ã‚‹', desc: 'ã€Œä»Šæ—¥ã‚„ã‚‹ã“ã¨ã€ã‚¿ãƒ–ã‹ã‚‰LNã‚’é¸ã¶', action: "showPanel('list'); setListTab('ready');" },
          { icon: '2ï¸âƒ£', name: 'Aâ‘¡ æ›¸é¡ãƒã‚§ãƒƒã‚¯ãƒªã‚¹ãƒˆç¢ºèª', desc: 'LNè©³ç´°ã§å¿…è¦æ›¸é¡ã‚’ç¢ºèª', action: "openDetailOrPrompt();" },
          { icon: '3ï¸âƒ£', name: 'Aâ‘¢ CSVãƒ»Driveãƒ•ã‚©ãƒ«ãƒ€ç¢ºèª', desc: 'ãƒ•ã‚¡ã‚¤ãƒ«ãŒæƒã£ã¦ã„ã‚‹ã‹ãƒã‚§ãƒƒã‚¯', action: "openDetailOrPrompt();" },
          { icon: 'âœ…', name: 'å®Œäº†å ±å‘Š', desc: 'å•é¡Œãªã‘ã‚Œã°å ±å‘Šã—ã¦çµ‚äº†', action: "window.open('lngame.html?panel=report&user='+currentUser.id,'_blank');" }
        );
      } else if (currentRole === 'expert') {
        tasks.push(
          { icon: 'ğŸ“‚', name: 'A è¨¼æ‹ åé›†ï¼ˆå…¨èˆ¬ï¼‰', desc: 'LNç¢ºèªâ†’ãƒã‚§ãƒƒã‚¯â†’ä¸è¶³æ›¸é¡ã®æ‰‹é…â†’ãƒœãƒƒã‚¯ã‚¹è©°ã‚', action: "showPanel('list'); setListTab('ready');" },
          { icon: 'ğŸ“', name: 'Bâ‘  ç”³ç«‹æ›¸ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆåˆ©ç”¨', desc: 'æº–å‚™å®Œäº†LNã®ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆã«æƒ…å ±ã‚’æµã—è¾¼ã‚€', action: "showPanel('list'); setListTab('ready');" },
          { icon: 'ğŸ“‹', name: 'Bâ‘¡ è¨¼æ‹ èª¬æ˜æ›¸ã®ä½œæˆ', desc: 'è¨¼æ‹ ãƒªã‚¹ãƒˆã‚’æ•´ç†ã—èª¬æ˜æ›¸ã‚’è‡ªå‹•ç”Ÿæˆ', action: "openDetailOrPrompt();" },
          { icon: 'âš ï¸', name: 'è¦å¯¾å¿œLNã‚’å‡¦ç†', desc: 'ä¸è¶³ã‚„å•é¡Œã®ã‚ã‚‹LNã«å¯¾å¿œ', action: "showPanel('list'); setListTab('action');" },
          { icon: 'âœ…', name: 'å®Œäº†å ±å‘Š', desc: 'æœ¬æ—¥ã®å¯¾å¿œã‚’å ±å‘Š', action: "window.open('lngame.html?panel=report&user='+currentUser.id,'_blank');" }
        );
      } else {
        tasks.push(
          { icon: 'ğŸ“Š', name: 'ãƒãƒ¼ãƒ çŠ¶æ³ç¢ºèª', desc: 'LNå…¨ä½“ã®é€²æ—ãƒ»æ›¸é¡çŠ¶æ³ã‚’æŠŠæ¡', action: "showPanel('list'); setListViewMode('status');" },
          { icon: 'ğŸ“‚', name: 'A è¨¼æ‹ åé›†ãƒ»B ç”³ç«‹æ›¸ä½œæˆ', desc: 'å…¨å·¥ç¨‹ã‚’å®Ÿæ–½ï¼ˆè¨¼æ‹ åé›†ã€œç”³ç«‹æ›¸ä½œæˆï¼‰', action: "showPanel('list'); setListTab('all');" },
          { icon: 'ğŸ”', name: 'Bâ‘¢ å†…å®¹ç¢ºèªãƒ»ä¿®æ­£', desc: 'ç”Ÿæˆã•ã‚ŒãŸç”³ç«‹æ›¸ã‚’ç²¾æŸ»ã—ä¿®æ­£', action: "openDetailOrPrompt();" },
          { icon: 'âœ”ï¸', name: 'Bâ‘£ æœ€çµ‚æ‰¿èªãƒ»æå‡º', desc: 'æœ€çµ‚ãƒã‚§ãƒƒã‚¯å¾Œã€æå‡ºã‚’æ‰¿èª', action: "alert('ãƒ¢ãƒƒã‚¯: æœ€çµ‚æå‡ºãƒ•ãƒ­ãƒ¼');" },
          { icon: 'âœ…', name: 'å®Œäº†å ±å‘Š', desc: 'æœ¬æ—¥ã®å¯¾å¿œã‚’å ±å‘Š', action: "window.open('lngame.html?panel=report&user='+currentUser.id,'_blank');" }
        );
      }
      body.innerHTML = '<div style="display:flex;flex-wrap:wrap;gap:10px;">' + tasks.map((t, i) =>
        '<div onclick="' + t.action + '" style="flex:1;min-width:140px;max-width:220px;cursor:pointer;padding:12px 14px;border-radius:10px;background:var(--surface2);border:1px solid var(--border);transition:all 0.2s;" onmouseover="this.style.transform=\'translateY(-2px)\';this.style.boxShadow=\'0 4px 12px rgba(0,0,0,0.06)\'" onmouseout="this.style.transform=\'none\';this.style.boxShadow=\'none\'">' +
          '<div style="font-size:20px;margin-bottom:6px;">' + t.icon + '</div>' +
          '<div style="font-size:12px;font-weight:600;margin-bottom:2px;">' + t.name + '</div>' +
          '<div style="font-size:10px;color:var(--muted);line-height:1.4;">' + t.desc + '</div>' +
        '</div>'
      ).join('') + '</div>';
    }

    function setUser(userId) {
      const u = USERS.find(x => x.id === userId) || USERS[0];
      currentUser = u;
      currentRole = u.role;
      const sel = document.getElementById('user-select');
      if (sel) sel.value = u.id;
      // ã‚¿ãƒ–è¡¨ç¤ºåˆ¶å¾¡
      const allTab = document.querySelector('[data-tab="all"]');
      const actionTab = document.querySelector('[data-tab="action"]');
      const processingTab = document.querySelector('[data-tab="processing"]');
      if (currentRole === 'beginner') {
        if (allTab) allTab.style.display = '';
        if (actionTab) actionTab.style.display = 'none';
        if (processingTab) processingTab.style.display = 'none';
      } else {
        if (allTab) allTab.style.display = '';
        if (actionTab) actionTab.style.display = '';
        if (processingTab) processingTab.style.display = '';
      }
      applyRoleView();
    }

    function showPanel(id) {
      document.querySelectorAll('.panel').forEach(p => p.classList.remove('active'));
      const panel = document.getElementById('panel-' + id);
      if (panel) panel.classList.add('active');
      // ãƒ‘ãƒãƒ«åˆ‡æ›¿æ™‚ã«ã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«ã‚’å…ˆé ­ã«æˆ»ã™
      window.scrollTo({ top: 0, behavior: 'smooth' });
      document.querySelectorAll('.sidebar-nav-item').forEach(el => el.classList.remove('active'));
      const navMap = { top: 0, list: 1 };
      // detail/templates/boxã¯listã®å­ãƒ‘ãƒãƒ«ã¨ã—ã¦æ‰±ã„ã€listã‚’ãƒã‚¤ãƒ©ã‚¤ãƒˆ
      const resolvedId = (id === 'detail' || id === 'templates' || id === 'box') ? 'list' : id;
      const idx = navMap[resolvedId];
      if (typeof idx === 'number') {
        const navs = document.querySelectorAll('.sidebar-nav-item');
        if (navs[idx]) navs[idx].classList.add('active');
      }
      if (id === 'list') {
        // beginneråˆå›ã¯'ready'ã€ãã‚Œä»¥å¤–ã¯ç¾åœ¨ã®ã‚¿ãƒ–çŠ¶æ…‹ã‚’ç¶­æŒï¼ˆåˆå›ã¯'all'ï¼‰
        if (currentRole === 'beginner') setListTab('ready');
        else setListTab(currentListTab || 'all');
        updateLnStatusTable();
      }
      // ãƒ¬ãƒãƒ¼ãƒˆãƒ»ãƒªãƒ¼ãƒ€ãƒ¼ãƒœãƒ¼ãƒ‰ã¯lngame.htmlã«ç§»å‹•æ¸ˆã¿
      if (id !== 'detail') updateSidebarFeedback(null, null);
    }

    let currentLnStatusFilter = 'all';
    function setLnStatusFilter(filter) {
      currentLnStatusFilter = filter || 'all';
      document.querySelectorAll('.ln-status-tab').forEach(t => t.classList.toggle('active', t.dataset.lnStatusFilter === currentLnStatusFilter));
      updateLnStatusTable();
    }
    function updateLnStatusTable() {
      const tbody = document.getElementById('ln-status-body');
      if (!tbody) return;
      
      // localStorageã‹ã‚‰ä¿å­˜ã•ã‚ŒãŸã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ã‚’èª­ã¿è¾¼ã¿
      const savedStatuses = JSON.parse(localStorage.getItem('ln_doc_statuses') || '{}');
      const allLNChecklists = JSON.parse(localStorage.getItem('all_ln_checklists') || '{}');
      
      // LN_STATUS_DATAã‚’æ›´æ–°ï¼ˆln_doc_statusesã¨all_ln_checklistsã®ä¸¡æ–¹ã‹ã‚‰ï¼‰
      LN_STATUS_DATA.forEach(r => {
        // æ›¸é¡æŠŠæ¡ã§ç›´æ¥è¨­å®šã—ãŸå€¤
        if (savedStatuses[r.ln]) {
          r.p = savedStatuses[r.ln].p !== undefined ? savedStatuses[r.ln].p : r.p;
          r.kk = savedStatuses[r.ln].kk !== undefined ? savedStatuses[r.ln].kk : r.kk;
          r.usb = savedStatuses[r.ln].usb !== undefined ? savedStatuses[r.ln].usb : r.usb;
          r.cert = savedStatuses[r.ln].cert !== undefined ? savedStatuses[r.ln].cert : r.cert;
        }
        
        // lnmake.htmlã‹ã‚‰ã®å€¤ã§ä¸Šæ›¸ãï¼ˆã‚ˆã‚Šæ–°ã—ã„å ´åˆï¼‰
        if (allLNChecklists[r.ln]) {
          const lnCheck = allLNChecklists[r.ln];
          if (lnCheck.inin !== undefined) r.p = lnCheck.inin;
          if (lnCheck.cert !== undefined) r.cert = lnCheck.cert;
          if (lnCheck.usb !== undefined) r.usb = lnCheck.usb;
        }
      });
      
      let list = LN_STATUS_DATA;
      if (currentLnStatusFilter === 'go') list = list.filter(r => r.p && r.kk);
      else if (currentLnStatusFilter === 'collect') list = list.filter(r => !r.p || !r.kk);
      
      const docCell = (lnId, field, value) => {
        const checked = value ? 'checked' : '';
        const status = value ? '<span class="doc-ok">ã€‡</span>' : '<span class="doc-ng">Ã—</span>';
        return `<div class="doc-cell">
          <input type="checkbox" class="doc-status-checkbox" ${checked} 
            onchange="toggleDocStatus('${lnId}', '${field}', this.checked)"
            title="${value ? 'âœ“ å®Œäº†' : 'Ã— æœªå®Œäº†'} - ã‚¯ãƒªãƒƒã‚¯ã§å¤‰æ›´">
          ${status}
        </div>`;
      };
      
      const rows = list.map(r => {
        const canGo = r.p && r.kk;
        const rowClass = canGo ? 'status-go' : '';
        const status = canGo ? 'é€²ã‚ã‚‹' : (!r.p && !r.kk ? 'å§”ä»»çŠ¶ãƒ»KKåé›†ä¸­' : r.p ? 'KKåé›†ä¸­' : 'å§”ä»»çŠ¶åé›†ä¸­');
        return `<tr class="${rowClass}">
          <td><strong>${r.ln}</strong></td>
          <td>${r.cp} / ${r.partner}</td>
          <td>${docCell(r.ln, 'p', r.p)}</td>
          <td>${docCell(r.ln, 'kk', r.kk)}</td>
          <td>${docCell(r.ln, 'usb', r.usb)}</td>
          <td>${docCell(r.ln, 'cert', r.cert)}</td>
          <td>${status}</td>
        </tr>`;
      });
      tbody.innerHTML = rows.join('');
    }
    
    // æ›¸é¡ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ã‚’æ›´æ–°
    function toggleDocStatus(lnId, field, isChecked) {
      // localStorageã«ä¿å­˜
      const savedStatuses = JSON.parse(localStorage.getItem('ln_doc_statuses') || '{}');
      if (!savedStatuses[lnId]) {
        savedStatuses[lnId] = {};
      }
      savedStatuses[lnId][field] = isChecked;
      localStorage.setItem('ln_doc_statuses', JSON.stringify(savedStatuses));
      
      // all_ln_checklistsã‚‚æ›´æ–°ï¼ˆlnmake.htmlã¨ã®é€£æºï¼‰
      const allLNChecklists = JSON.parse(localStorage.getItem('all_ln_checklists') || '{}');
      if (!allLNChecklists[lnId]) {
        allLNChecklists[lnId] = {};
      }
      // ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰åã®ãƒãƒƒãƒ”ãƒ³ã‚°
      const fieldMap = {
        'p': 'inin',      // å§”ä»»çŠ¶
        'cert': 'cert',   // è¨¼æ˜æ›¸
        'usb': 'usb',     // USB
        'kk': 'kk'        // KKã¯å‚è€ƒæƒ…å ±ã¨ã—ã¦ä¿å­˜
      };
      if (fieldMap[field]) {
        allLNChecklists[lnId][fieldMap[field]] = isChecked;
      }
      allLNChecklists[lnId].lastUpdated = new Date().toISOString();
      localStorage.setItem('all_ln_checklists', JSON.stringify(allLNChecklists));
      
      // lnmake.htmlç”¨ã®å€‹åˆ¥ãƒã‚§ãƒƒã‚¯ãƒªã‚¹ãƒˆã‚‚æ›´æ–°ï¼ˆå®Œå…¨åŒæœŸï¼‰
      const lnChecklistKey = `ln_checklist_${lnId}`;
      const lnChecklist = JSON.parse(localStorage.getItem(lnChecklistKey) || '{}');
      const taskIdMap = {
        'p': 'task-inin',
        'cert': 'task-cert',
        'usb': 'task-usb',
        'kk': 'task-kk'
      };
      if (taskIdMap[field]) {
        lnChecklist[taskIdMap[field]] = isChecked;
        localStorage.setItem(lnChecklistKey, JSON.stringify(lnChecklist));
      }
      
      // ãƒ†ãƒ¼ãƒ–ãƒ«ã‚’å†æç”»
      updateLnStatusTable();
      
      // LNä¸€è¦§ã‚‚æ›´æ–°ï¼ˆæº–å‚™çŠ¶æ³ã«åæ˜ ï¼‰
      if (typeof renderLnList === 'function') {
        renderLnList();
      }
      
      console.log(`âœ“ ${lnId} ã® ${field} ã‚’ ${isChecked ? 'å®Œäº†' : 'æœªå®Œäº†'} ã«æ›´æ–°ã—ã¾ã—ãŸï¼ˆlnmake.htmlã¨åŒæœŸï¼‰`);
    }


    // ãƒãƒ‹ãƒ¥ã‚¢ãƒ«é–¢é€£JS â†’ lnmanual.html ã«ç§»å‹•

    let currentListViewMode = 'list';
    function setListViewMode(mode) {
      currentListViewMode = mode || 'list';
      document.querySelectorAll('.ln-view-mode-tab').forEach(t => t.classList.toggle('active', t.dataset.view === currentListViewMode));
      const listEl = document.getElementById('ln-view-list');
      const statusEl = document.getElementById('ln-view-status');
      if (listEl) listEl.style.display = currentListViewMode === 'list' ? '' : 'none';
      if (statusEl) statusEl.style.display = currentListViewMode === 'status' ? '' : 'none';
      if (currentListViewMode === 'status') updateLnStatusTable();
    }

    function setListTab(tab) {
      currentListTab = tab;
      document.querySelectorAll('#panel-list .tab').forEach(t => {
        t.classList.toggle('active', t.dataset.tab === tab);
      });
      // æ¤œç´¢ãƒ•ã‚£ãƒ«ã‚¿ã‚‚è€ƒæ…®ã—ã¦å†ãƒ•ã‚£ãƒ«ã‚¿
      const q = (document.getElementById('ln-search')?.value || '').toLowerCase().trim();
      let visible = 0;
      document.querySelectorAll('.ln-card').forEach(row => {
        const status = row.dataset.status;
        let tabMatch = true;
        if (tab === 'ready') tabMatch = status === 'ready';
        else if (tab === 'action') tabMatch = status === 'action';
        else if (tab === 'processing') tabMatch = status === 'processing';
        const searchMatch = !q || (row.dataset.search || '').includes(q);
        const show = tabMatch && searchMatch;
        row.style.display = show ? '' : 'none';
        if (show) visible++;
      });
      const cnt = document.getElementById('ln-list-count');
      if (cnt) cnt.textContent = tab === 'all' && !q ? 'å…¨13ä»¶' : visible + 'ä»¶';
    }

    // caseData ã¯ db_case.js ã§å®šç¾©æ¸ˆã¿



    /* ======== LNä¸€è¦§ å‹•çš„ãƒ¬ãƒ³ãƒ€ãƒªãƒ³ã‚°ï¼ˆmakelné€²æ—è¡¨ç¤ºä»˜ãï¼‰ ======== */
    function renderLnList() {
      const container = document.getElementById('ln-list-body');
      if (!container) return;
      container.innerHTML = '';
      
      // localStorageã‹ã‚‰å…¨LNã®ãƒã‚§ãƒƒã‚¯çŠ¶æ…‹ã‚’èª­ã¿è¾¼ã¿
      const allLNChecklists = JSON.parse(localStorage.getItem('all_ln_checklists') || '{}');
      
      const lnKeys = Object.keys(caseData);
      lnKeys.forEach(id => {
        const d = caseData[id];
        const ev = d.ev || {};
        
        // ãƒ‘ãƒ¼ã‚»ãƒ³ãƒ†ãƒ¼ã‚¸ã‚’å…ˆã«è¨ˆç®—
        const kkPct = ev.kk ? Math.round(ev.kk.done / ev.kk.total * 100) : 0;
        const plPct = ev.pl ? Math.round(ev.pl.done / ev.pl.total * 100) : 0;
        
        // lnmake.htmlã‹ã‚‰ã®ãƒã‚§ãƒƒã‚¯çŠ¶æ…‹ã‚’åæ˜ 
        if (allLNChecklists[id]) {
          ev.manual = {
            inin: allLNChecklists[id].inin || false,
            cert: allLNChecklists[id].cert || false,
            box: allLNChecklists[id].box || false,
            usb: allLNChecklists[id].usb || false
          };
          
          // æº–å‚™å®Œäº†åº¦ã‚’å†è¨ˆç®—ï¼ˆæ‰‹å‹•ãƒã‚§ãƒƒã‚¯4é …ç›® + è‡ªå‹•6é …ç›® = åˆè¨ˆ10é …ç›®ï¼‰
          const manualChecks = [ev.manual.inin, ev.manual.cert, ev.manual.box, ev.manual.usb];
          const manualDone = manualChecks.filter(Boolean).length;
          
          // è‡ªå‹•ãƒã‚§ãƒƒã‚¯é …ç›®ã®å®Œäº†æ•°ã‚’è¨ˆç®—
          const autoDone = [
            (kkPct === 100),  // ç”²10å®Œäº†
            (plPct === 100),  // ç”²11å®Œäº†
            true,             // IPNä¸€è¦§ï¼ˆä»®å®šï¼‰
            true,             // åŒä¸€ãƒ•ã‚¡ã‚¤ãƒ«ï¼ˆä»®å®šï¼‰
            true,             // GoogleDriveé€£æºï¼ˆä»®å®šï¼‰
            allLNChecklists[id].appendix || false  // åˆ¥ç´™ç¢ºèª
          ].filter(Boolean).length;
          
          ev.prep = {
            done: manualDone + autoDone,
            total: 10
          };
        } else if (!ev.manual) {
          // ãƒã‚§ãƒƒã‚¯çŠ¶æ…‹ãŒãªã„å ´åˆã¯ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆå€¤ã‚’è¨­å®š
          ev.manual = {
            inin: false,
            cert: false,
            box: false,
            usb: false
          };
        }
        
        const prepPct = ev.prep ? Math.round(ev.prep.done / ev.prep.total * 100) : 0;
        const docs = ev.docs || {};
        const docIcons = (docs.honbun ? 'âœ“' : 'âœ—') + (docs.shomei ? 'âœ“' : 'âœ—') + ((docs.beshi||[]).every(Boolean) ? 'âœ“' : 'âœ—');
        const docColor = (docs.honbun && docs.shomei && (docs.beshi||[]).every(Boolean)) ? '#15803d' : '#b45309';
        const statusClass = d.status === 'ã™ãä½œæˆå¯èƒ½' ? 'status-ready' : 'status-action';
        const searchText = (id + ' ' + d.applicant + ' ' + d.opponent + ' ' + (d.product || '')).toLowerCase();
        const dataStatus = d.status === 'ã™ãä½œæˆå¯èƒ½' ? 'ready' : 'action';

        // Card row
        const row = document.createElement('div');
        row.className = 'ln-card';
        row.setAttribute('data-status', dataStatus);
        row.setAttribute('data-search', searchText);

        row.innerHTML = `
          <div class="ln-card-head" onclick="toggleLnExpand('${id}', event)">
            <div class="ln-card-left">
              <span class="ln-card-num">${id}</span>
              <span class="ln-card-parties">${d.applicant} / ${d.opponent}</span>
            </div>
            <div class="ln-card-right">
              <span class="ln-card-ip">${d.ipCount || '-'}ä»¶</span>
              <span class="ln-card-docs" style="color:${docColor}" title="æœ¬æ–‡/èª¬æ˜æ›¸/åˆ¥ç´™">${docIcons}</span>
              <span class="status-badge ${statusClass}">${d.status}</span>
              <span class="ln-card-date">${d.date || ''}</span>
              <span class="ln-card-arrow" id="expand-icon-${id}">â–¼</span>
            </div>
          </div>
          <div class="ln-card-bars">
            <div class="ln-bar-group">
              <span class="ln-bar-label">ç”²10</span>
              <span class="ln-bar-pct" style="background:${kkPct===100?'#d1fae5':'#fef3c7'};color:${kkPct===100?'#065f46':'#92400e'}">${kkPct}%</span>
            </div>
            <div class="ln-bar-group">
              <span class="ln-bar-label">ç”²11</span>
              <span class="ln-bar-pct" style="background:${plPct===100?'#d1fae5':'#dbeafe'};color:${plPct===100?'#065f46':'#1e40af'}">${plPct}%</span>
            </div>
            <div class="ln-bar-group">
              <span class="ln-bar-label">æº–å‚™</span>
              <span class="ln-bar-pct" style="background:${prepPct===100?'#d1fae5':'#ede9fe'};color:${prepPct===100?'#065f46':'#5b21b6'}">${ev.prep?ev.prep.done+'/'+ev.prep.total:'-'}</span>
            </div>
          </div>
          <div class="ln-expand-detail" id="expand-${id}" style="display:none">
            <div class="ln-expand-grid">
              <div>
                <div class="ln-expand-item"><span class="ln-expand-label">ç”³ç«‹ç¨®é¡</span><span class="ln-expand-val">${ev.appealType || '-'}</span></div>
                <div class="ln-expand-item"><span class="ln-expand-label">è‘—ä½œæ¨©ãƒ‘ã‚¿ãƒ¼ãƒ³</span><span class="ln-expand-val">${ev.pattern || '-'}</span></div>
                <div class="ln-expand-item"><span class="ln-expand-label">loå‡¦ç†</span><span class="ln-expand-val">${ev.lo?ev.lo.done+'/'+ev.lo.total+'ä»¶ ('+Math.round(ev.lo.done/ev.lo.total*100)+'%)':'-'}</span></div>
              </div>
              <div>
                <div class="ln-expand-item"><span class="ln-expand-label">ç”²10 ä¸è¶³æç•ª</span><span class="ln-expand-val ev-missing">${(ev.kkMissing||[]).length>0?'æ¬ : '+(ev.kkMissing||[]).join(', '):'âœ“ å®Œäº†'}</span></div>
                <div class="ln-expand-item"><span class="ln-expand-label">ç”²11 ä¸è¶³æç•ª</span><span class="ln-expand-val ev-missing">${(ev.plMissing||[]).length>0?'æ¬ : '+(ev.plMissing||[]).slice(0,8).join(', ')+(ev.plMissing.length>8?' ä»–'+(ev.plMissing.length-8)+'ä»¶':''):'âœ“ å®Œäº†'}</span></div>
                <div class="ln-expand-item"><span class="ln-expand-label">æ‰‹å‹•ãƒã‚§ãƒƒã‚¯</span><span class="ln-expand-val">${ev.manual?('å§”ä»»çŠ¶ <span style="color:'+(ev.manual.inin?'#059669':'#dc2626')+'">'+(ev.manual.inin?'âœ“':'âœ—')+'</span> / è¨¼æ˜æ›¸ <span style="color:'+(ev.manual.cert?'#059669':'#dc2626')+'">'+(ev.manual.cert?'âœ“':'âœ—')+'</span> / Box <span style="color:'+(ev.manual.box?'#059669':'#dc2626')+'">'+(ev.manual.box?'âœ“':'âœ—')+'</span> / USB <span style="color:'+(ev.manual.usb?'#059669':'#dc2626')+'">'+(ev.manual.usb?'âœ“':'âœ—')+'</span>'):'-'}</span></div>
              </div>
            </div>
            <div class="ln-expand-actions">
              <a href="lnmake.html?ln=${id}" class="ln-open-makeln" onclick="event.stopPropagation()">ğŸ“ makelnã§é–‹ã â†’<span class="element-id" title="è¦ç´ ID: P-30">P-30</span></a>
              ${d.driveFolderUrl ? `<a href="${d.driveFolderUrl}" class="ln-drive-link" target="_blank" onclick="event.stopPropagation()">ğŸ“ Drive: LNãƒ•ã‚©ãƒ«ãƒ€<span class="element-id" title="è¦ç´ ID: P-31">P-31</span></a>` : ''}
              ${d.plDriveUrl ? `<a href="${d.plDriveUrl}" class="ln-drive-link" target="_blank" onclick="event.stopPropagation()">ğŸ“ Drive: plãƒ•ã‚©ãƒ«ãƒ€<span class="element-id" title="è¦ç´ ID: P-32">P-32</span></a>` : ''}
              <button class="ln-db-files-btn" onclick="event.stopPropagation(); alert('DBæ ¼ç´ãƒ•ã‚¡ã‚¤ãƒ«é–²è¦§æ©Ÿèƒ½ã¯é–‹ç™ºä¸­ã§ã™')" disabled title="å°†æ¥å®Ÿè£…: DBæ ¼ç´ãƒ•ã‚¡ã‚¤ãƒ«">ğŸ—„ï¸ DBãƒ•ã‚¡ã‚¤ãƒ«ï¼ˆé–‹ç™ºä¸­ï¼‰<span class="element-id" title="è¦ç´ ID: P-33">P-33</span></button>
            </div>
          </div>
        `;
        container.appendChild(row);
      });
    }

    var expandedLn = null;
    function toggleLnExpand(id, event) {
      if (event) event.preventDefault();
      const el = document.getElementById('expand-' + id);
      const icon = document.getElementById('expand-icon-' + id);
      if (!el) return;
      if (expandedLn && expandedLn !== id) {
        const prev = document.getElementById('expand-' + expandedLn);
        const prevIcon = document.getElementById('expand-icon-' + expandedLn);
        if (prev) prev.style.display = 'none';
        if (prevIcon) prevIcon.textContent = 'â–¼';
      }
      if (el.style.display === 'none') {
        el.style.display = 'block';
        if (icon) icon.textContent = 'â–²';
        expandedLn = id;
      } else {
        el.style.display = 'none';
        if (icon) icon.textContent = 'â–¼';
        expandedLn = null;
      }
    }

    function setDetailCase(id) {
      // panel-detail å‰Šé™¤æ¸ˆã¿ â€” ã‚µã‚¤ãƒ‰ãƒãƒ¼ã®ãƒ•ã‚£ãƒ¼ãƒ‰ãƒãƒƒã‚¯æ›´æ–°ã®ã¿æ®‹ã™
      const d = caseData[id];
      if (!d) return;
      currentDetailLn = id || '';
      updateSidebarFeedback(id, d);
    }

    function updateSidebarFeedback(lnId, d) {
      const el = document.getElementById('sidebar-feedback-content');
      if (!el) return;
      const feedback = d?.automationFeedback || [];
      if (feedback.length > 0) {
        el.textContent = '';
        el.classList.remove('empty');
        feedback.forEach((msg, i) => {
          const p = document.createElement('div');
          p.style.marginBottom = i < feedback.length - 1 ? '6px' : '0';
          p.textContent = 'ãƒ»' + msg;
          el.appendChild(p);
        });
      } else {
        el.textContent = lnId ? 'è‡ªå‹•åŒ–æ¸ˆã¿ã€‚æ‰‹å‹•ä½œæ¥­ã¯å§”ä»»çŠ¶ãƒ»ä»£è¡¨è€…äº‹é …è¨¼æ˜æ›¸ãƒ»KKãƒ»æ›¸é¡ãƒœãƒƒã‚¯ã‚¹è©°ã‚ã®ã¿ã€‚' : 'LNã‚’é¸æŠã™ã‚‹ã¨ã€è‡ªå‹•åŒ–ã§ããªã‹ã£ãŸé …ç›®ãŒã“ã“ã«è¡¨ç¤ºã•ã‚Œã¾ã™ã€‚';
        el.classList.add('empty');
      }
    }

    // TEMPLATES ã¯ db_case.js ã§å®šç¾©æ¸ˆã¿


    function showTemplate(key) {
      const el = document.getElementById('template-preview');
      if (!el) return;
      if (!key || !TEMPLATES[key]) {
        el.textContent = 'ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆã‚’é¸æŠã™ã‚‹ã¨ã“ã“ã«è¡¨ç¤ºã•ã‚Œã¾ã™ã€‚â—éƒ¨åˆ†ã‚’ç·¨é›†ã—ã¦ä½¿ç”¨ã—ã¦ãã ã•ã„ã€‚';
        el.style.color = 'var(--muted)';
        return;
      }
      el.textContent = TEMPLATES[key];
      el.style.color = 'var(--ink)';
    }

    function setDocType(type) {
      const sel = document.getElementById('doc-type-select');
      if (sel) sel.value = type;
      const full = document.getElementById('full-doc-type');
      if (full) full.value = type;
      const desc = document.getElementById('doc-type-desc');
      if (desc) {
        const texts = {
          open: '<strong>ç™ºä¿¡è€…æƒ…å ±é–‹ç¤ºå‘½ä»¤æ›¸</strong> â€” é–‹ç¤ºè«‹æ±‚ã®ã¿ã€‚å¿…è¦åˆ¥ç´™: å½“äº‹è€…ç›®éŒ²ã€è‘—ä½œç‰©ç›®éŒ²ã€å‹•ç”»ç›®éŒ²ã€ç™ºä¿¡è€…æƒ…å ±ç›®éŒ²ï¼ˆï¼‘ï¼‰ã€‚',
          delete: '<strong>ç™ºä¿¡è€…æƒ…å ±é–‹ç¤ºå‘½ä»¤æ›¸å…¼æ¶ˆå»ç¦æ­¢å‘½ä»¤ç”³ç«‹æ›¸</strong> â€” ä¸Šè¨˜ã«åŠ ãˆ: ç™ºä¿¡è€…æƒ…å ±ã®ä¿æœ‰ã€ç¬¬ï¼“ æ¶ˆå»ç¦æ­¢å‘½ä»¤ã®ç”³ç«‹ã¦ï¼ˆã‚¢ã‚¯ã‚»ã‚¹ãƒ­ã‚°ä¿å­˜æœŸé–“å¾’éã®ãŠãã‚Œï¼‰ã€‚',
          provide: '<strong>ç™ºä¿¡è€…æƒ…å ±é–‹ç¤ºå‘½ä»¤æ›¸å…¼æä¾›å‘½ä»¤ç”³ç«‹æ›¸</strong> â€” ä¸Šè¨˜ã«åŠ ãˆ: ä¸»æ–‡ç›®éŒ²ã€ç™ºä¿¡è€…æƒ…å ±ç›®éŒ²ï¼ˆï¼’ï¼‰é€šä¿¡å›ç·šæƒ…å ±ï¼ˆIPãƒ»ç™ºä¿¡æ™‚åˆ»ãƒ»ãƒãƒ¼ãƒˆï¼‰ã€‚'
        };
        desc.innerHTML = texts[type] || texts.open;
      }
      updateFullDocSample();
    }

    const KANTOKU = `ï¼•ã€€ç”³ç«‹äººãŒè‘—ä½œæ¨©è€…ã§ã‚ã‚‹ã“ã¨
ã€€ç”³ç«‹äººã¯ã€æœ¬ä»¶è‘—ä½œç‰©ï¼ˆç”²ï¼‘ï¼“ï¼‰ã‚’æœ€åˆã«ç™ºæ„ã—ã¦ä¼ç”»ã—ã€æœ¬ä»¶è‘—ä½œç‰©ã®åˆ¶ä½œè²»ç”¨å…¨ã¦ã‚’è² æ‹…ã™ã‚‹ç­‰ã®è²¬ä»»ã‚’è² ã†ä¸»ä½“ã§ã‚ã£ãŸã€‚
ã‚ˆã£ã¦ã€ç”³ç«‹äººã¯æœ¬ä»¶è‘—ä½œç‰©ã®ã€Œæ˜ ç”»è£½ä½œè€…ã€ï¼ˆè‘—ä½œæ¨©æ³•ç¬¬ï¼’æ¡ç¬¬ï¼‘ï¼å·ï¼‰ã«å½“ãŸã‚‹ã€‚
ã€€ç”³ç«‹äººã¯ã€ã€Œæœ±é›€ã€åŠã³ã€Œã‚­ãƒªãƒãƒã‚µãƒ ãƒã€ã“ã¨ç”³ç«‹å¤–å‰æ²¢å®Ÿã«å¯¾ã—ã¦æœ¬ä»¶è‘—ä½œç‰©ã®è£½ä½œã‚’ä¾é ¼ã—ã€åŒäººãŒç›£ç£ã‚’æ‹…å½“ã—ãŸã€‚åŒäººã¯ã€è„šæœ¬ã®å‰µä½œã‚„æ˜ åƒã®ç·¨é›†ç­‰ã®ç·æŒ‡æ®ã‚’è¡Œã£ã¦ã€æœ¬ä»¶è‘—ä½œç‰©ã®è„šæœ¬ã‚„æ˜ åƒå†…å®¹ã«é–¢ã™ã‚‹æœ€çµ‚æ±ºå®šæ¨©é™ã‚’æœ‰ã—ã¦ãŠã‚Šã€æœ¬ä»¶è‘—ä½œç‰©ã«ã€Œå…¨ä½“çš„å½¢æˆã«å‰µä½œçš„ã«å¯„ä¸ã—ã€ã¦ãŠã‚Šã€è‘—ä½œè€…ã«å½“ãŸã‚‹ï¼ˆè‘—ä½œæ¨©æ³•ç¬¬ï¼‘ï¼–æ¡ï¼‰ã€‚
ã€€ã“ã®ç‚¹ã€æœ¬ä»¶è‘—ä½œç‰©ã®åˆ¶ä½œã«ã‚ãŸã‚Šã€åŒäººã¯ã€æ˜ ç”»è£½ä½œè€…ã§ã‚ã‚‹ç”³ç«‹äººã«å¯¾ã—ã€æœ¬ä»¶è‘—ä½œç‰©ã®åˆ¶ä½œã«å‚åŠ ã™ã‚‹ã“ã¨ã‚’ç´„æŸã—ã¦ã„ãŸã“ã¨ã‹ã‚‰ï¼ˆç”²ï¼‘ï¼”ï¼‰ã€æœ¬ä»¶è‘—ä½œç‰©ã®è‘—ä½œæ¨©ã¯ç”³ç«‹äººã«å¸°å±ã—ãŸï¼ˆè‘—ä½œæ¨©æ³•ç¬¬ï¼’ï¼™æ¡ç¬¬ï¼‘é …ï¼‰ã€‚
ã€€ã‚ˆã£ã¦ã€ç”³ç«‹äººã¯ã€ç›¸æ‰‹æ–¹ã«å¯¾ã—ã€æƒ…å ±æµé€šãƒ—ãƒ©ãƒƒãƒˆãƒ•ã‚©ãƒ¼ãƒ å¯¾å‡¦æ³•ç¬¬ï¼˜æ¡ã€ç¬¬ï¼•æ¡ï¼‘é …ã«åŸºã¥ãã€åˆ¥ç´™ç™ºä¿¡è€…æƒ…å ±ç›®éŒ²è¨˜è¼‰ã®æƒ…å ±ã®é–‹ç¤ºã‚’æ±‚ã‚ã‚‹ã€‚`;

    const MUKANTOKU = `ã€€åˆ¥ç´™è‘—ä½œç‰©ç›®éŒ²è¨˜è¼‰ã®å‹•ç”»ï¼ˆä»¥ä¸‹ã€ã€Œæœ¬ä»¶è‘—ä½œç‰©ã€ã¨ã„ã†ã€‚ï¼‰ã‚’åéŒ²ã—ãŸï¼¤ï¼¶ï¼¤ã®ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ï¼ˆç”²ï¼‘ï¼“ï¼‰ã®å·¦ä¸‹ã«ã€ã€Œè£½ä½œãƒ»è‘—ä½œãƒ»å—å¯© â—ï¼³ï¼¯ï¼¤ã‚¯ãƒªã‚¨ã‚¤ãƒˆï¼ˆæ ªï¼‰ã€ã¨ç”³ç«‹äººã®å•†å·ãŒè¡¨ç¤ºã•ã‚Œã¦ã„ã‚‹ã“ã¨ã‹ã‚‰ã€ç”³ç«‹äººã¯è‘—ä½œè€…ã¨æ¨å®šã•ã‚Œã‚‹ï¼ˆè‘—ä½œæ¨©æ³•ç¬¬ï¼‘ï¼”æ¡ï¼‰ã€‚ã“ã®æ¨å®šã‚’è¦†ã™äº‹å®Ÿã¯ãªã„ã€‚
ã€€ã€€ã€€ã—ãŸãŒã£ã¦ã€ç”³ç«‹äººã¯ã€æœ¬ä»¶è‘—ä½œç‰©ã«å¯¾ã™ã‚‹è‘—ä½œæ¨©ã‚’æœ‰ã™ã‚‹ï¼ˆè‘—ä½œæ¨©æ³•ç¬¬ï¼‘ï¼—æ¡ï¼‘é …ï¼‰ã€‚`;

    const HOJYU = `ï¼”ã€€ç™ºä¿¡è€…æƒ…å ±ã®ä¿æœ‰
ç›¸æ‰‹æ–¹ã¯ã€æœ¬ä»¶å„ç™ºä¿¡è€…ã«ã¤ã„ã¦ã®ã€åˆ¥ç´™ç™ºä¿¡è€…æƒ…å ±ç›®éŒ²è¨˜è¼‰ã®æƒ…å ±ï¼ˆæ°ååˆã¯åç§°ã€ä½æ‰€ã€é›»è©±ç•ªå·åŠã³é›»å­ãƒ¡ãƒ¼ãƒ«ã‚¢ãƒ‰ãƒ¬ã‚¹ã®æƒ…å ±ï¼‰ã‚’ä¿æœ‰ã—ã¦ã„ã‚‹ã€‚
ãªãŠã€æœ¬ä»¶å„é€šä¿¡ã«ãŠã„ã¦ã¯ã€åˆ¥ç´™å‹•ç”»ç›®éŒ²ã«ãŠã‘ã‚‹ã€ŒIPã‚¢ãƒ‰ãƒ¬ã‚¹ï¼ˆæ¥ç¶šå…ˆï¼‰ã€æ¬„ã«ãŠã„ã¦ã€æœ¬ä»¶èª¿æŸ»ä¼šç¤¾å´ã®ï¼©ï¼°ã‚¢ãƒ‰ãƒ¬ã‚¹ã‚‚è¨˜è¼‰ã—ã¦ã„ã‚‹ã€‚ç›¸æ‰‹æ–¹ã«ãŠã‹ã‚Œã¦ã¯ä¿æœ‰ç¢ºèªã‚’è¡Œã†éš›ã«å½“è©²ï¼©ï¼°ã‚¢ãƒ‰ãƒ¬ã‚¹ã®æƒ…å ±ã‚‚åŠ å‘³ã—ãŸä¸Šã§èª¿æŸ»ã•ã‚ŒãŸã„ã€‚`;

    const SHOKIN = `ç¬¬ï¼“ã€€æ¶ˆå»ç¦æ­¢å‘½ä»¤ã®ç”³ç«‹ã¦
ç¾æ®µéšã§ã¯ã€ç›¸æ‰‹æ–¹ãŒåˆ¥ç´™ç™ºä¿¡è€…æƒ…å ±ç›®éŒ²è¨˜è¼‰ã®æƒ…å ±ã‚’ä»»æ„ã«ä¿å­˜ã™ã‚‹ã‹å¦ã‹ã¯æ˜ã‚‰ã‹ã§ã¯ãªãã€ä¸Šè¨˜é–‹ç¤ºå‘½ä»¤ã®ç™ºä»¤ã‚’å¾…ã£ã¦ã„ã¦ã¯ç›¸æ‰‹æ–¹ã«ãŠã‘ã‚‹ã‚¢ã‚¯ã‚»ã‚¹ãƒ­ã‚°ã®ä¿å­˜æœŸé–“ã‚’å¾’éã—ã€æœ¬ä»¶å„ç™ºä¿¡è€…ã‚’ç‰¹å®šã™ã‚‹ã“ã¨ãŒã§ããªããªã‚‹ãŠãã‚ŒãŒã‚ã‚‹ã€‚
ã‚ˆã£ã¦ã€ç”³ç«‹äººã¯ã€æƒ…å ±æµé€šãƒ—ãƒ©ãƒƒãƒˆãƒ•ã‚©ãƒ¼ãƒ å¯¾å‡¦æ³•ç¬¬ï¼‘ï¼–æ¡ï¼‘é …ã«åŸºã¥ãã€ç›¸æ‰‹æ–¹ã«å¯¾ã™ã‚‹åˆ¥ç´™ç™ºä¿¡è€…æƒ…å ±ç›®éŒ²è¨˜è¼‰ã®æƒ…å ±ã®æ¶ˆå»ç¦æ­¢å‘½ä»¤ã‚’æ±‚ã‚ã‚‹ã€‚`;

    function updateFullDocSample() {
      const el = document.getElementById('full-doc-sample');
      if (!el) return;
      const docType = document.getElementById('full-doc-type')?.value || 'open';
      const proof = document.getElementById('copyright-proof')?.value || 'kantoku';
      const kantoku = proof === 'kantoku';
      const shokyi = docType === 'delete';
      const teikyo = docType === 'provide';

      let s = `ä»¤å’Œã€€ã€€å¹´ã€€ã€€æœˆã€€ã€€ã€€æ—¥
æ±äº¬åœ°æ–¹è£åˆ¤æ‰€æ°‘äº‹éƒ¨ã€€å¾¡ä¸­
ç”³ç«‹äººæ‰‹ç¶šä»£ç†äººå¼è­·å£«ã€€ã€€æˆ¸ã€€ç”°ã€€ã€€ã€€ã€€æ³‰
ã€€ã€€å½“äº‹è€…ã®è¡¨ç¤ºã€€ã€€åˆ¥ç´™å½“äº‹è€…ç›®éŒ²è¨˜è¼‰ã®ã¨ãŠã‚Š

ç”³ç«‹ã¦ã®è¶£æ—¨
ï¼‘ã€€ç™ºä¿¡è€…æƒ…å ±é–‹ç¤ºå‘½ä»¤ã®ç”³ç«‹ã¦
ç›¸æ‰‹æ–¹ã¯ã€ç”³ç«‹äººã«å¯¾ã—ã€åˆ¥ç´™ç™ºä¿¡è€…æƒ…å ±ç›®éŒ²è¨˜è¼‰ã®æƒ…å ±ã‚’é–‹ç¤ºã›ã‚ˆ
ã¨ã®è£åˆ¤ã‚’æ±‚ã‚ã‚‹ã€‚
`;
      if (shokyi) {
        s += `ï¼’ã€€æ¶ˆå»ç¦æ­¢å‘½ä»¤ã®ç”³ç«‹ã¦
ã€€ã€€ç›¸æ‰‹æ–¹ã¯ã€å‰é …ã®ç”³ç«‹ã¦ã«ä¿‚ã‚‹ç™ºä¿¡è€…æƒ…å ±é–‹ç¤ºå‘½ä»¤ç”³ç«‹äº‹ä»¶ï¼ˆå½“è©²ç”³ç«‹ã¦ã«ã¤ã„ã¦ã®æ±ºå®šï¼ˆå½“è©²ç”³ç«‹ã¦ã‚’ä¸é©æ³•ã¨ã—ã¦å´ä¸‹ã™ã‚‹æ±ºå®šã‚’é™¤ãã€‚ï¼‰ã«å¯¾ã—ã¦ç•°è­°ã®è¨´ãˆãŒæèµ·ã•ã‚ŒãŸã¨ãã¯ã€ãã®è¨´è¨Ÿï¼‰ãŒçµ‚äº†ã™ã‚‹ã¾ã§ã®é–“ã€åˆ¥ç´™ç™ºä¿¡è€…æƒ…å ±ç›®éŒ²è¨˜è¼‰ã®æƒ…å ±ã‚’æ¶ˆå»ã—ã¦ã¯ãªã‚‰ãªã„
ã€€ã¨ã®è£åˆ¤ã‚’æ±‚ã‚ã‚‹ã€‚

`;
      }
      s += `ï¼ˆç†ç”±ï¼‰

`;
      if (shokyi) {
        s += HOJYU + `

`;
      }
      s += (kantoku ? KANTOKU : MUKANTOKU) + `

`;
      if (shokyi) {
        s += SHOKIN + `

`;
      }
      s += `é™„å±æ›¸é¡
ï¼‘ã€€è¨¼æ‹ èª¬æ˜æ›¸ã€€ã€€ã€€ã€€ã€€ï¼‘é€š
ï¼’ã€€ç”²å·å„è¨¼ã€€ã€€ã€€ã€€ã€€å„ï¼‘é€š
ï¼“ã€€è³‡æ ¼è¨¼æ˜æ›¸ã€€ã€€ã€€ã€€ã€€ï¼’é€š
ï¼”ã€€æ‰‹ç¶šä»£ç†å§”ä»»çŠ¶ã€€ã€€ã€€ã€€é€šã€€æ‰‹æ›¸ã

ï¼ˆåˆ¥ç´™ï¼‰
å½“ã€€äº‹ã€€è€…ã€€ç›®ã€€éŒ²

ã€’ï¼‘ï¼ï¼‘ï¼ï¼ï¼ï¼–ï¼•ã€€æ±äº¬éƒ½åƒä»£ç”°åŒºè¥¿ç¥ç”°ä¸‰ä¸ç›®ï¼“ç•ªï¼™å·
ç”³ç«‹äººã€€æ ªå¼ä¼šç¤¾ãƒã‚¤ãƒ­ãƒ¼ãƒ«
ã€€ã€€ã€€ã€€ã€€ã€€ã€€ã€€ã€€ã€€ä¸Šè¨˜ä»£è¡¨è€…ä»£è¡¨å–ç· å½¹ã€€ã€€ã€€ã€€å°å‡ºã€€è£•è²´

ã€’ï¼‘ï¼ï¼˜ï¼ï¼ï¼ï¼’ï¼“ã€€æ±äº¬éƒ½æ¸¯åŒºèŠæµ¦ï¼”ï¼ï¼‘ï¼–ï¼ï¼’ï¼“ã€€ã‚¢ã‚¯ã‚¢ã‚·ãƒ†ã‚£èŠæµ¦ï¼™éš
ã€€ã€€ã€€ã€€ã€€ã€€ã€€ã€€ã€€ã€€å¼è­·å£«æ³•äººï¼©ï¼´ï¼ªæ³•å¾‹äº‹å‹™æ‰€ï¼ˆé€é”å ´æ‰€ï¼‰
ã€€ã€€ã€€ã€€ã€€ã€€ã€€ã€€ã€€ã€€é›»è©±ã€€ã€€ï¼ï¼•ï¼ï¼ˆï¼•ï¼˜ï¼”ï¼–ï¼‰ï¼—ï¼’ï¼•ï¼‘
ã€€ã€€ã€€ã€€ã€€ã€€ã€€ã€€ã€€ã€€ï¼¦ï¼¡ï¼¸ã€€ï¼ï¼“ï¼ˆï¼•ï¼—ï¼“ï¼ï¼‰ï¼ï¼’ï¼’ï¼–
ã€€ã€€ã€€ã€€ã€€ã€€ã€€ã€€ã€€ã€€ç”³ç«‹äººæ‰‹ç¶šä»£ç†äººå¼è­·å£«ã€€ã€€ã€€æˆ¸ç”°ã€€æ³‰
ã€€ã€€ã€€ã€€ã€€ã€€ã€€ã€€ã€€ã€€åŒã€€ã€€ã€€ã€€ã€€ã€€ã€€å¼è­·å£«ã€€ã€€ã€€è§’åœ°å±±ã€€å®—è¡Œ
ã€€ã€€ã€€ã€€ã€€ã€€ã€€ã€€ã€€ã€€åŒã€€ã€€ã€€ã€€ã€€ã€€ã€€å¼è­·å£«ã€€ã€€ã€€å¤§å¡šã€€ç›´
ã€€ã€€ã€€ã€€ã€€ã€€ã€€ã€€ã€€ã€€åŒã€€ã€€ã€€ã€€ã€€ã€€ã€€å¼è­·å£«ã€€ã€€ã€€æ²³ç”°ã€€éš†å…‹
ã€€ã€€ã€€ã€€ã€€ã€€ã€€ã€€ã€€ã€€åŒã€€ã€€ã€€ã€€ã€€ã€€ã€€å¼è­·å£«ã€€ã€€ã€€æ¸…æ°´ã€€è¡
ã€€ã€€ã€€ã€€ã€€ã€€ã€€ã€€ã€€ã€€åŒã€€ã€€ã€€ã€€ã€€ã€€ã€€å¼è­·å£«ã€€ã€€ã€€ç• å±±ã€€æ™ƒ

ã€’ï¼‘ï¼ï¼•ï¼ï¼—ï¼•ï¼’ï¼™ã€€æ±äº¬éƒ½æ¸¯åŒºæµ·å²¸ä¸€ä¸ç›®ï¼—ç•ªï¼‘å·
ç›¸æ‰‹æ–¹ã€€ã‚½ãƒ•ãƒˆãƒãƒ³ã‚¯æ ªå¼ä¼šç¤¾
ã€€ã€€ã€€ã€€ã€€ã€€ã€€ã€€ã€€ã€€ä¸Šè¨˜ä»£è¡¨è€…ä»£è¡¨å–ç· å½¹ã€€ã€€ã€€ã€€å®®å·ã€€æ½¤ä¸€

ï¼ˆåˆ¥ç´™ï¼‰
è‘—ã€€ä½œã€€ç‰©ã€€ç›®ã€€éŒ²

ã€ãƒ—ãƒ¬ãƒŸã‚¢ãƒ ãƒ»ã‚·ãƒªãƒ¼ã‚ºãƒ»ã‚¹ãƒšã‚·ãƒ£ãƒ«ã€åŸâ—¯ã‚·ãƒ‹â—¯ãƒ¼ãƒ©(æ·‘å¥³)æ§˜ã€‘ã‚¬ãƒçˆ†ä¹³ï¼«ã‚«ãƒƒãƒ—108cmç¨®ä»˜ã‘å­•ã¾ã›å¦Šå¨ ã‚¶ãƒ¼ãƒ¡ãƒ³ç”Ÿä¸­å‡ºã—å®Œå…¨ç€è¡£ã‚»ãƒƒã‚¯ã‚¹ã€æ½®å¹ã/å£å†…å°„ç²¾/æ”¾å°¿/è†£å†…ä¸­å‡ºã—å°„ç²¾/è¿½æ’ƒæ”¾å°¿/è¿½æ’ƒå£å†…å°„ç²¾ã€‘ã€ï¼ˆSHC082ï¼‰
ã€ã‚³ã‚¹ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼ã®åŒ‚ã„ã€å¤©æµ·â—¯é¦™ç·¨â‘¢ãƒ”ãƒ³ã‚¯ãƒ€ã‚¤ã‚¢ãƒ¢ãƒ³ãƒ‰ã€‘ã‚¬ãƒåŒäººå£°å„ªç¾å°‘å¥³ã¡ã‚ƒã‚“ã€Œã‚ãŸã—ã®ç”Ÿåæ¯ã‚’è€³ã‹ã‚‰ãƒ–ãƒè¾¼ã¾ã‚Œã¦è„³ã‚¤ã‚­ã—ã‚ã€ãƒã‚¤ãƒãƒ¼ãƒ©ãƒ«ä¹³é¦–è²¬ã‚ã€ç‰¹å…¸ã€‘ã‚¬ãƒå®Ÿæ¼”æœ¬æ°—ã‚ªãƒŠÃ—ç”˜ãƒˆãƒ­åªš**ãƒãƒæ±ã‚¨ã‚¹ãƒ†SPã€ï¼ˆSHC089ï¼‰
ã€ç€è¡£æ€§äº¤ä¼èª¬ã€ã©ã™ã‘ã¹å›½å®¶ãƒ•ã‚§ãƒ©ãƒ†ãƒ¼ãƒŒã€‘å¡©å‘³ï¼ˆãˆã‚“ã¿ï¼‰ã®åŠ¹ã„ãŸå¤§é‡ã‚¤ã‚­æ½®ãƒãƒ¡æ½®ã‚¢ã‚¯ãƒ¡æ½®ã¶ã¡æ’’ãï¼“ãƒªãƒƒãƒˆãƒ«ä½èº«é•·145cmã‚¯ã‚½é›‘é­šãƒ¡ã‚¹ã‚¬ã‚­ãƒ¬ã‚¤ãƒ¤ãƒ¼ç”Ÿãƒãƒ¡ä¸­å‡ºã—å­•ã¾ã›ç¨®ä»˜ã‘å­ä½œã‚Šãƒ•ã‚¡ãƒƒã‚¯ã€åŸâ—¯ãƒ•ãƒªãƒ¼ãƒŠã€‘ã€ï¼ˆSHC093ï¼‰
ï¼ˆä»¥ä¸‹ã€è‘—ä½œç‰©ç›®éŒ²è¨˜è¼‰ã®ã¨ãŠã‚Šï¼‰

`;
      if (teikyo) {
        s += `ï¼ˆåˆ¥ç´™ï¼‰
ä¸»ã€€æ–‡ã€€ç›®ã€€éŒ²

ã€€ç›¸æ‰‹æ–¹ã¯ã€ç”³ç«‹äººã«å¯¾ã—ã€åˆ¥ç´™ç™ºä¿¡è€…æƒ…å ±ç›®éŒ²ï¼ˆï¼’ï¼‰è¨˜è¼‰ã®æƒ…å ±ã®ã†ã¡ç›¸æ‰‹æ–¹ãŒä¿æœ‰ã™ã‚‹ã‚‚ã®ã«ã‚ˆã‚Šç‰¹å®šã§ãã‚‹ã€åˆ¥ç´™å‹•ç”»ç›®éŒ²è¨˜è¼‰ã®æƒ…å ±ã«ä¿‚ã‚‹ä»–ã®é–‹ç¤ºé–¢ä¿‚å½¹å‹™æä¾›è€…ï¼ˆå½“è©²æƒ…å ±ã®ç™ºä¿¡è€…ã§ã‚ã‚‹ã¨èªã‚ã‚‰ã‚Œã‚‹ã‚‚ã®ã‚’é™¤ãã€‚ï¼‰ã®æ°ååˆã¯åç§°åŠã³ä½æ‰€ã‚’æ›¸é¢åˆã¯é›»ç£çš„æ–¹æ³•ã«ã‚ˆã‚Šæä¾›ã›ã‚ˆã€‚

ã€€ä»¥ä¸Š

`;
      }
      s += `ï¼ˆåˆ¥ç´™ï¼‰
ç™ºã€€ä¿¡ã€€è€…ã€€æƒ…ã€€å ±ã€€ç›®ã€€éŒ²ï¼ˆï¼‘ï¼‰

åˆ¥ç´™å‹•ç”»ç›®éŒ²è¨˜è¼‰ã®å„ï¼©ï¼°ã‚¢ãƒ‰ãƒ¬ã‚¹ã‚’ã€åŒç›®éŒ²è¨˜è¼‰ã®å„ç™ºä¿¡æ™‚åˆ»é ƒã«ç›¸æ‰‹æ–¹ã‹ã‚‰å‰²ã‚Šå½“ã¦ã‚‰ã‚Œã¦ã„ãŸå¥‘ç´„è€…ã«é–¢ã™ã‚‹ä»¥ä¸‹ã®æƒ…å ±ã€‚
ã€€â‘ ã€€æ°ååˆã¯åç§°
ã€€â‘¡ã€€ä½æ‰€
ã€€â‘¢ã€€é›»è©±ç•ªå·
ã€€â‘£ã€€é›»å­ãƒ¡ãƒ¼ãƒ«ã‚¢ãƒ‰ãƒ¬ã‚¹

`;
      if (teikyo) {
        s += `ï¼ˆåˆ¥ç´™ï¼‰
ç™ºã€€ä¿¡ã€€è€…ã€€æƒ…ã€€å ±ã€€ç›®ã€€éŒ²ï¼ˆï¼’ï¼‰

ã€€åˆ¥ç´™å‹•ç”»ç›®éŒ²è¨˜è¼‰ã®å„ï¼©ï¼°ã‚¢ãƒ‰ãƒ¬ã‚¹ï¼ˆæ¥ç¶šå…ƒï¼‰ã‚’åŒç›®éŒ²è¨˜è¼‰ã®å„ç™ºä¿¡æ™‚åˆ»ã«å‰²ã‚Šå½“ã¦ã‚‰ã‚ŒãŸé€šä¿¡å›ç·šã«ä¿‚ã‚‹ä»¥ä¸‹ã®æƒ…å ±
ã€€ã‚¢ã€€ï¼©ï¼°ã‚¢ãƒ‰ãƒ¬ã‚¹ï¼ˆæ¥ç¶šå…ƒï¼‰
ã€€ã‚¤ã€€ç™ºä¿¡æ™‚åˆ»
ã€€ã‚¦ã€€ãƒãƒ¼ãƒˆç•ªå·ï¼ˆæ¥ç¶šå…ƒï¼‰
`;
      }
      el.textContent = s;
    }

    function updateSummaryCards() {
      const rows = document.querySelectorAll('.ln-card');
      let all = 0, ready = 0, action = 0, processing = 0;
      rows.forEach(row => {
        all++;
        const s = row.dataset.status;
        if (s === 'ready') ready++;
        else if (s === 'action') action++;
        else if (s === 'processing') processing++;
      });
      const set = (id, v) => { const e = document.getElementById(id); if (e) e.textContent = v; };
      set('summary-all', all);
      set('summary-ready', ready);
      set('summary-processing', processing);
      set('summary-action', action);
      // ã‚¿ãƒ–ã®ä»¶æ•°è¡¨ç¤ºã‚‚æ›´æ–°
      document.querySelectorAll('#panel-list .tab').forEach(t => {
        const cnt = t.querySelector('.count');
        if (!cnt) return;
        const tab = t.dataset.tab;
        if (tab === 'all') cnt.textContent = all + 'ä»¶';
        else if (tab === 'ready') cnt.textContent = ready + 'ä»¶';
        else if (tab === 'action') cnt.textContent = action + 'ä»¶';
        else if (tab === 'processing') cnt.textContent = processing + 'ä»¶';
      });
    }

    function filterLnList() {
      const q = (document.getElementById('ln-search').value || '').toLowerCase().trim();
      document.querySelectorAll('.ln-card').forEach(row => {
        const match = !q || (row.dataset.search || '').includes(q);
        const tabMatch = currentListTab === 'all' || row.dataset.status === currentListTab;
        row.style.display = (match && tabMatch) ? '' : 'none';
      });
    }

    document.getElementById('ln-search')?.addEventListener('keypress', function(e) {
      if (e.key === 'Enter') filterLnList();
    });

    document.addEventListener('DOMContentLoaded', function() {
      renderLnList();
      setUser('nobunaga');
      setDocType('open');
      updateFullDocSample();
      renderFeedbackLog();
      updateSummaryCards();
      // box-checklist â†’ lnmanual.html ã«ç§»å‹•æ¸ˆã¿
    });
    
    // lnmake.htmlã‹ã‚‰æˆ»ã£ã¦ããŸæ™‚ã«LNä¸€è¦§ã¨æ›¸é¡æŠŠæ¡ã‚’æ›´æ–°
    window.addEventListener('focus', function() {
      renderLnList();
      if (currentListViewMode === 'status') {
        updateLnStatusTable();
      }
      console.log('âœ“ ãƒšãƒ¼ã‚¸ãƒ•ã‚©ãƒ¼ã‚«ã‚¹: LNä¸€è¦§ã‚’æ›´æ–°ã—ã¾ã—ãŸ');
    });
    
    // localStorageã®å¤‰æ›´ã‚’æ¤œçŸ¥ã—ã¦æ›´æ–°ï¼ˆåŒä¸€ãƒ–ãƒ©ã‚¦ã‚¶ã®åˆ¥ã‚¿ãƒ–ï¼‰
    window.addEventListener('storage', function(e) {
      if (e.key === 'all_ln_checklists' || e.key === 'ln_doc_statuses') {
        renderLnList();
        if (currentListViewMode === 'status') {
          updateLnStatusTable();
        }
        console.log('âœ“ ãƒã‚§ãƒƒã‚¯ãƒªã‚¹ãƒˆæ›´æ–°ã‚’æ¤œçŸ¥: LNä¸€è¦§ã¨æ›¸é¡æŠŠæ¡ã‚’æ›´æ–°ã—ã¾ã—ãŸ');
      }
    });

    document.getElementById('full-doc-type')?.addEventListener('change', function() {
      setDocType(this.value);
    });
  </script>

  <!-- ========== ä½œæˆä¾é ¼ãƒ†ã‚­ã‚¹ãƒˆç”Ÿæˆãƒ¢ãƒ¼ãƒ€ãƒ« ========== -->
  <div id="requestTextModal" style="display:none;position:fixed;inset:0;background:rgba(0,0,0,0.6);z-index:9999;align-items:center;justify-content:center" onclick="if(event.target.id==='requestTextModal')this.style.display='none'">
    <div style="background:#fff;border-radius:16px;max-width:700px;width:90%;max-height:85vh;overflow-y:auto;box-shadow:0 20px 60px rgba(0,0,0,0.3)" onclick="event.stopPropagation()">
      <div style="display:flex;justify-content:space-between;align-items:center;padding:24px 24px 16px;border-bottom:1px solid #e5e7eb">
        <div style="font-size:18px;font-weight:700;color:#111827">ğŸ“‹ æ›¸é¡ä½œæˆä¾é ¼ãƒ†ã‚­ã‚¹ãƒˆ</div>
        <button onclick="document.getElementById('requestTextModal').style.display='none'" style="width:32px;height:32px;border-radius:8px;border:none;background:#f3f4f6;color:#6b7280;cursor:pointer;font-size:20px">Ã—</button>
      </div>
      <div style="padding:24px">
        <div style="background:#eff6ff;border:1px solid #bfdbfe;border-radius:8px;padding:12px 16px;margin-bottom:16px;font-size:13px">
          <strong>ğŸ’¡ ä½¿ã„æ–¹ï¼š</strong> ä¸è¶³ã—ã¦ã„ã‚‹æ›¸é¡ã”ã¨ã«LNç•ªå·ã‚’ã¾ã¨ã‚ã¦ã„ã¾ã™ã€‚Google Chatã‚„ãƒ¡ãƒ¼ãƒ«ã«ã‚³ãƒ”ãƒ¼ã—ã¦é€ä¿¡ã—ã¦ãã ã•ã„ã€‚
        </div>
        <div style="position:relative">
          <textarea id="requestTextContent" readonly style="width:100%;min-height:400px;padding:16px;border:1px solid #d1d5db;border-radius:8px;font-family:monospace;font-size:13px;line-height:1.8;resize:vertical;background:#f9fafb"></textarea>
          <button onclick="copyRequestText()" style="position:absolute;top:12px;right:12px;padding:8px 16px;background:#059669;color:#fff;border:none;border-radius:6px;font-size:12px;font-weight:600;cursor:pointer;box-shadow:0 2px 8px rgba(5,150,105,0.3)">
            ğŸ“‹ ã‚³ãƒ”ãƒ¼
          </button>
        </div>
        <div id="requestTextCopyStatus" style="margin-top:12px;padding:12px;border-radius:8px;text-align:center;font-size:13px;font-weight:600;display:none"></div>
      </div>
    </div>
  </div>

  <script>
  // ä½œæˆä¾é ¼ãƒ†ã‚­ã‚¹ãƒˆã‚’ç”Ÿæˆ
  function generateRequestText() {
    // localStorageã‹ã‚‰æœ€æ–°ã®çŠ¶æ…‹ã‚’å–å¾—ã—ã¦LN_STATUS_DATAã‚’æ›´æ–°
    const savedStatuses = JSON.parse(localStorage.getItem('ln_doc_statuses') || '{}');
    const allLNChecklists = JSON.parse(localStorage.getItem('all_ln_checklists') || '{}');
    
    LN_STATUS_DATA.forEach(r => {
      if (savedStatuses[r.ln]) {
        r.p = savedStatuses[r.ln].p !== undefined ? savedStatuses[r.ln].p : r.p;
        r.kk = savedStatuses[r.ln].kk !== undefined ? savedStatuses[r.ln].kk : r.kk;
        r.usb = savedStatuses[r.ln].usb !== undefined ? savedStatuses[r.ln].usb : r.usb;
        r.cert = savedStatuses[r.ln].cert !== undefined ? savedStatuses[r.ln].cert : r.cert;
      }
      if (allLNChecklists[r.ln]) {
        const lnCheck = allLNChecklists[r.ln];
        if (lnCheck.inin !== undefined) r.p = lnCheck.inin;
        if (lnCheck.cert !== undefined) r.cert = lnCheck.cert;
        if (lnCheck.usb !== undefined) r.usb = lnCheck.usb;
      }
    });
    
    // ç¾åœ¨ã®LNãƒ‡ãƒ¼ã‚¿ã‚’å–å¾—
    const lnData = LN_STATUS_DATA;
    
    // ä¸è¶³ã—ã¦ã„ã‚‹æ›¸é¡ã”ã¨ã«LNã‚’åˆ†é¡
    const missing = {
      p: [],      // å§”ä»»çŠ¶
      kk: [],     // KK
      usb: [],    // è¨¼æ‹ ç”¨USB
      cert: []    // ä»£è¡¨è€…äº‹é …è¨¼æ˜æ›¸
    };
    
    lnData.forEach(ln => {
      if (!ln.p) missing.p.push(ln.ln);
      if (!ln.kk) missing.kk.push(ln.ln);
      if (!ln.usb) missing.usb.push(ln.ln);
      if (!ln.cert) missing.cert.push(ln.ln);
    });
    
    // ãƒ†ã‚­ã‚¹ãƒˆã‚’ç”Ÿæˆ
    const totalMissing = missing.p.length + missing.kk.length + missing.usb.length + missing.cert.length;
    
    let text = '';
    
    if (totalMissing === 0) {
      text = 'ğŸ‰ ã€æ›¸é¡çŠ¶æ³ã€‘\n\n';
      text += 'âœ… ã™ã¹ã¦ã®æ›¸é¡ãŒæƒã£ã¦ã„ã¾ã™ï¼\n';
      text += 'ç”³ç«‹æ›¸ä½œæˆã‚’é€²ã‚ã‚‹ã“ã¨ãŒã§ãã¾ã™ã€‚\n\n';
      text += 'â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”\n';
      text += 'â€» ç”Ÿæˆæ—¥æ™‚: ' + new Date().toLocaleString('ja-JP');
    } else {
      text = 'ğŸ“‹ ã€æ›¸é¡ä½œæˆä¾é ¼ã€‘\n\n';
      text += 'ä»¥ä¸‹ã®LNã§æ›¸é¡ãŒä¸è¶³ã—ã¦ã„ã¾ã™ã€‚\n';
      text += 'ã”ç¢ºèªãƒ»ã”æ‰‹é…ã‚’ãŠé¡˜ã„ã—ã¾ã™ã€‚\n\n';
      text += 'â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”\n\n';
      
      if (missing.p.length > 0) {
        text += 'ğŸ”´ å§”ä»»çŠ¶ãŒä¸è¶³ã—ã¦ã„ã‚‹LNï¼ˆ' + missing.p.length + 'ä»¶ï¼‰\n';
        text += '   ' + missing.p.join(', ') + '\n\n';
      }
      
      if (missing.kk.length > 0) {
        text += 'ğŸŸ¡ KKï¼ˆDBè¨˜éŒ²å°åˆ·æ›¸é¢ï¼‰ãŒä¸è¶³ã—ã¦ã„ã‚‹LNï¼ˆ' + missing.kk.length + 'ä»¶ï¼‰\n';
        text += '   ' + missing.kk.join(', ') + '\n\n';
      }
      
      if (missing.usb.length > 0) {
        text += 'ğŸŸ  è¨¼æ‹ ç”¨USBãŒä¸è¶³ã—ã¦ã„ã‚‹LNï¼ˆ' + missing.usb.length + 'ä»¶ï¼‰\n';
        text += '   ' + missing.usb.join(', ') + '\n\n';
      }
      
      if (missing.cert.length > 0) {
        text += 'ğŸ”µ ä»£è¡¨è€…äº‹é …è¨¼æ˜æ›¸ãŒä¸è¶³ã—ã¦ã„ã‚‹LNï¼ˆ' + missing.cert.length + 'ä»¶ï¼‰\n';
        text += '   ' + missing.cert.join(', ') + '\n\n';
      }
      
      text += 'â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”\n';
      text += 'ğŸ“Š ä¸è¶³ä»¶æ•°åˆè¨ˆ: ' + totalMissing + 'ä»¶\n';
      text += 'ğŸ“… ç”Ÿæˆæ—¥æ™‚: ' + new Date().toLocaleString('ja-JP') + '\n';
      text += 'ğŸ’» ã‚·ã‚¹ãƒ†ãƒ : ç”³ç«‹æ›¸ä½œæˆãƒãƒ¼ã‚¿ãƒ« > æ›¸é¡æŠŠæ¡';
    }
    
    // ãƒ¢ãƒ¼ãƒ€ãƒ«ã«è¡¨ç¤º
    document.getElementById('requestTextContent').value = text;
    document.getElementById('requestTextModal').style.display = 'flex';
    document.getElementById('requestTextCopyStatus').style.display = 'none';
  }
  
  // ãƒ†ã‚­ã‚¹ãƒˆã‚’ã‚³ãƒ”ãƒ¼
  function copyRequestText() {
    const textarea = document.getElementById('requestTextContent');
    textarea.select();
    textarea.setSelectionRange(0, 99999); // ãƒ¢ãƒã‚¤ãƒ«å¯¾å¿œ
    
    // Clipboard APIã‚’ä½¿ç”¨ï¼ˆãƒ¢ãƒ€ãƒ³ãƒ–ãƒ©ã‚¦ã‚¶ï¼‰
    if (navigator.clipboard && navigator.clipboard.writeText) {
      navigator.clipboard.writeText(textarea.value).then(() => {
        showCopySuccess();
      }).catch(() => {
        // ãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯
        document.execCommand('copy');
        showCopySuccess();
      });
    } else {
      // å¤ã„ãƒ–ãƒ©ã‚¦ã‚¶ç”¨ãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯
      document.execCommand('copy');
      showCopySuccess();
    }
  }
  
  function showCopySuccess() {
    const status = document.getElementById('requestTextCopyStatus');
    status.textContent = 'âœ“ ã‚³ãƒ”ãƒ¼ã—ã¾ã—ãŸï¼Google Chatã«è²¼ã‚Šä»˜ã‘ã¦ãã ã•ã„';
    status.style.background = '#d1fae5';
    status.style.color = '#065f46';
    status.style.display = 'block';
    
    setTimeout(() => {
      status.style.display = 'none';
    }, 3000);
  }
  
  // ESCã‚­ãƒ¼ã§ãƒ¢ãƒ¼ãƒ€ãƒ«ã‚’é–‰ã˜ã‚‹
  document.addEventListener('keydown', function(e) {
    if (e.key === 'Escape') {
      const modal = document.getElementById('requestTextModal');
      if (modal && modal.style.display === 'flex') {
        modal.style.display = 'none';
      }
    }
  });
  </script>

  <!-- ========== ãƒ•ã‚£ãƒ¼ãƒ‰ãƒãƒƒã‚¯æ©Ÿèƒ½ ========== -->
  <style>
  /* ãƒ•ã‚£ãƒ¼ãƒ‰ãƒãƒƒã‚¯ãƒœã‚¿ãƒ³ï¼ˆå›ºå®šï¼‰ */
  .feedback-float-btn {
    position: fixed;
    bottom: 24px;
    right: 24px;
    width: 60px;
    height: 60px;
    border-radius: 50%;
    background: linear-gradient(135deg, #3b82f6 0%, #2563eb 100%);
    color: white;
    border: none;
    box-shadow: 0 4px 12px rgba(59, 130, 246, 0.4);
    cursor: pointer;
    font-size: 24px;
    display: flex;
    align-items: center;
    justify-content: center;
    z-index: 9998;
    transition: all 0.3s ease;
  }
  .feedback-float-btn:hover {
    transform: scale(1.1);
    box-shadow: 0 6px 20px rgba(59, 130, 246, 0.5);
  }
  .feedback-float-btn:active {
    transform: scale(0.95);
  }

  /* ãƒ•ã‚£ãƒ¼ãƒ‰ãƒãƒƒã‚¯ãƒ¢ãƒ¼ãƒ€ãƒ« */
  .feedback-modal-overlay {
    display: none;
    position: fixed;
    inset: 0;
    background: rgba(0, 0, 0, 0.6);
    z-index: 9999;
    align-items: center;
    justify-content: center;
    animation: fadeIn 0.2s ease;
  }
  .feedback-modal-overlay.active {
    display: flex;
  }
  @keyframes fadeIn {
    from { opacity: 0; }
    to { opacity: 1; }
  }
  .feedback-modal-box {
    background: #fff;
    border-radius: 16px;
    max-width: 600px;
    width: 90%;
    max-height: 85vh;
    overflow-y: auto;
    box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
    animation: slideUp 0.3s ease;
  }
  @keyframes slideUp {
    from { transform: translateY(20px); opacity: 0; }
    to { transform: translateY(0); opacity: 1; }
  }
  .feedback-modal-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    padding: 24px 24px 16px;
    border-bottom: 1px solid #e5e7eb;
  }
  .feedback-modal-title {
    font-size: 18px;
    font-weight: 700;
    color: #111827;
    display: flex;
    align-items: center;
    gap: 8px;
  }
  .feedback-modal-close {
    width: 32px;
    height: 32px;
    border-radius: 8px;
    border: none;
    background: #f3f4f6;
    color: #6b7280;
    cursor: pointer;
    font-size: 20px;
    display: flex;
    align-items: center;
    justify-content: center;
    transition: all 0.2s;
  }
  .feedback-modal-close:hover {
    background: #e5e7eb;
    color: #374151;
  }
  .feedback-modal-body {
    padding: 24px;
  }
  .feedback-form-group {
    margin-bottom: 20px;
  }
  .feedback-form-label {
    display: block;
    font-size: 13px;
    font-weight: 600;
    margin-bottom: 8px;
    color: #374151;
  }
  .feedback-form-select,
  .feedback-form-input,
  .feedback-form-textarea {
    width: 100%;
    padding: 12px;
    border: 1px solid #d1d5db;
    border-radius: 8px;
    font-family: inherit;
    font-size: 14px;
    transition: all 0.2s;
  }
  .feedback-form-select:focus,
  .feedback-form-input:focus,
  .feedback-form-textarea:focus {
    outline: none;
    border-color: #3b82f6;
    box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.1);
  }
  .feedback-form-textarea {
    min-height: 120px;
    resize: vertical;
    line-height: 1.6;
  }
  .feedback-form-submit {
    width: 100%;
    padding: 14px;
    background: linear-gradient(135deg, #3b82f6 0%, #2563eb 100%);
    color: white;
    border: none;
    border-radius: 8px;
    font-size: 15px;
    font-weight: 600;
    cursor: pointer;
    transition: all 0.2s;
  }
  .feedback-form-submit:hover {
    transform: translateY(-1px);
    box-shadow: 0 4px 12px rgba(59, 130, 246, 0.3);
  }
  .feedback-form-submit:active {
    transform: translateY(0);
  }
  .feedback-status {
    margin-top: 16px;
    padding: 12px;
    border-radius: 8px;
    text-align: center;
    font-size: 13px;
    font-weight: 600;
  }
  .feedback-status.success {
    background: #d1fae5;
    color: #065f46;
  }
  .feedback-status.error {
    background: #fee2e2;
    color: #991b1b;
  }
  </style>

  <!-- ãƒ•ã‚£ãƒ¼ãƒ‰ãƒãƒƒã‚¯ãƒœã‚¿ãƒ³ï¼ˆå›ºå®šï¼‰ -->
  <button class="feedback-float-btn" onclick="openFeedbackModal()" title="ãƒ•ã‚£ãƒ¼ãƒ‰ãƒãƒƒã‚¯ã‚’é€ä¿¡: P-99">
    <span style="font-size:24px">ğŸ’¬</span>
    <span class="element-id" style="position:absolute;bottom:2px;right:2px;font-size:7px;padding:1px 3px;background:#fff;color:#3b82f6" title="è¦ç´ ID: P-99">P-99</span>
  </button>

  <!-- ãƒ•ã‚£ãƒ¼ãƒ‰ãƒãƒƒã‚¯ãƒ¢ãƒ¼ãƒ€ãƒ« -->
  <div id="feedbackModalOverlay" class="feedback-modal-overlay" onclick="closeFeedbackModalOnOverlay(event)">
    <div class="feedback-modal-box">
      <div class="feedback-modal-header">
        <div class="feedback-modal-title">
          ğŸ’¬ ãƒ•ã‚£ãƒ¼ãƒ‰ãƒãƒƒã‚¯ã‚’é€ä¿¡
        </div>
        <button class="feedback-modal-close" onclick="closeFeedbackModal()">Ã—</button>
      </div>
      <div class="feedback-modal-body">
        <form id="feedbackForm" onsubmit="submitFeedback(event)">
          <div class="feedback-form-group">
            <label class="feedback-form-label">ãƒ•ã‚£ãƒ¼ãƒ‰ãƒãƒƒã‚¯ã®ç¨®é¡</label>
            <select id="feedbackType" class="feedback-form-select" required>
              <option value="">é¸æŠã—ã¦ãã ã•ã„</option>
              <option value="bug">ğŸ› ãƒã‚°ãƒ»ä¸å…·åˆ</option>
              <option value="improvement">ğŸ’¡ æ”¹å–„ææ¡ˆ</option>
              <option value="question">â“ è³ªå•ãƒ»ã‚ã‹ã‚‰ãªã„ã“ã¨</option>
              <option value="other">ğŸ“ ãã®ä»–</option>
            </select>
          </div>
          
          <div class="feedback-form-group">
            <label class="feedback-form-label">ãƒšãƒ¼ã‚¸ãƒ»æ©Ÿèƒ½åï¼ˆä»»æ„ï¼‰</label>
            <input type="text" id="feedbackLocation" class="feedback-form-input" 
              placeholder="ä¾‹: LNä¸€è¦§ã€ç”³ç«‹æ›¸ä½œæˆã€æ›¸é¡ãƒã‚§ãƒƒã‚¯ãƒªã‚¹ãƒˆ">
          </div>
          
          <div class="feedback-form-group">
            <label class="feedback-form-label">è©³ç´°ãªå†…å®¹ <span style="color:#ef4444">*</span></label>
            <textarea id="feedbackContent" class="feedback-form-textarea" required
              placeholder="ä¾‹: 
â€¢ æ›¸é¡ãƒã‚§ãƒƒã‚¯ãƒªã‚¹ãƒˆã§å§”ä»»çŠ¶ã«ãƒã‚§ãƒƒã‚¯ã‚’å…¥ã‚Œã¦ã‚‚ä¿å­˜ã•ã‚Œãªã„
â€¢ ç”³ç«‹æ›¸ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼ã®æ–‡å­—ãŒå°ã•ãã¦èª­ã¿ã«ãã„
â€¢ è¨¼æ‹ èª¬æ˜æ›¸ã®è‡ªå‹•ç”Ÿæˆæ©Ÿèƒ½ãŒã»ã—ã„
â€¢ ã“ã®ç”»é¢ã®ä½¿ã„æ–¹ãŒã‚ã‹ã‚‰ãªã„"></textarea>
          </div>
          
          <div class="feedback-form-group">
            <label class="feedback-form-label">ã‚ãªãŸã®ãŠåå‰ï¼ˆä»»æ„ï¼‰</label>
            <input type="text" id="feedbackName" class="feedback-form-input" 
              placeholder="ä¾‹: ç¹”ç”°ä¿¡é•·">
          </div>
          
          <button type="submit" class="feedback-form-submit">
            ğŸ“¤ é€ä¿¡ã™ã‚‹
          </button>
          
          <div id="feedbackStatus" class="feedback-status" style="display:none"></div>
        </form>
      </div>
    </div>
  </div>

  <script>
  // ãƒ•ã‚£ãƒ¼ãƒ‰ãƒãƒƒã‚¯æ©Ÿèƒ½ã®JavaScript
  (function() {
    // ãƒšãƒ¼ã‚¸æƒ…å ±ã‚’è‡ªå‹•å–å¾—
    function getPageInfo() {
      return {
        url: window.location.href,
        pathname: window.location.pathname,
        pageTitle: document.title,
        userAgent: navigator.userAgent,
        screenSize: window.screen.width + 'x' + window.screen.height,
        timestamp: new Date().toISOString()
      };
    }

    // ãƒ¢ãƒ¼ãƒ€ãƒ«ã‚’é–‹ã
    window.openFeedbackModal = function() {
      const modal = document.getElementById('feedbackModalOverlay');
      if (modal) {
        modal.classList.add('active');
        document.getElementById('feedbackForm').reset();
        document.getElementById('feedbackStatus').style.display = 'none';
        
        const pageName = document.title.split('â€”')[0].trim();
        document.getElementById('feedbackLocation').value = pageName;
        
        const savedName = localStorage.getItem('feedback_user_name');
        if (savedName) {
          document.getElementById('feedbackName').value = savedName;
        }
      }
    };

    // ãƒ¢ãƒ¼ãƒ€ãƒ«ã‚’é–‰ã˜ã‚‹
    window.closeFeedbackModal = function() {
      const modal = document.getElementById('feedbackModalOverlay');
      if (modal) {
        modal.classList.remove('active');
      }
    };

    // ã‚ªãƒ¼ãƒãƒ¼ãƒ¬ã‚¤ã‚¯ãƒªãƒƒã‚¯ã§é–‰ã˜ã‚‹
    window.closeFeedbackModalOnOverlay = function(event) {
      if (event.target.id === 'feedbackModalOverlay') {
        closeFeedbackModal();
      }
    };

    // ãƒ•ã‚£ãƒ¼ãƒ‰ãƒãƒƒã‚¯ã‚’é€ä¿¡
    window.submitFeedback = function(event) {
      event.preventDefault();
      
      const type = document.getElementById('feedbackType').value;
      const location = document.getElementById('feedbackLocation').value;
      const content = document.getElementById('feedbackContent').value.trim();
      const name = document.getElementById('feedbackName').value.trim();
      
      if (!content) {
        showFeedbackStatus('è©³ç´°ãªå†…å®¹ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„', 'error');
        return;
      }
      
      const feedback = {
        id: 'fb_' + Date.now() + '_' + Math.random().toString(36).substr(2, 9),
        type: type,
        location: location || document.title,
        content: content,
        name: name || 'åŒ¿å',
        pageInfo: getPageInfo(),
        timestamp: new Date().toISOString(),
        status: 'new'
      };
      
      const feedbacks = JSON.parse(localStorage.getItem('system_feedbacks') || '[]');
      feedbacks.push(feedback);
      localStorage.setItem('system_feedbacks', JSON.stringify(feedbacks));
      
      if (name) {
        localStorage.setItem('feedback_user_name', name);
      }
      
      showFeedbackStatus('âœ“ ãƒ•ã‚£ãƒ¼ãƒ‰ãƒãƒƒã‚¯ã‚’é€ä¿¡ã—ã¾ã—ãŸï¼ã”å”åŠ›ã‚ã‚ŠãŒã¨ã†ã”ã–ã„ã¾ã™ã€‚', 'success');
      
      setTimeout(() => {
        closeFeedbackModal();
      }, 2000);
      
      console.log('ãƒ•ã‚£ãƒ¼ãƒ‰ãƒãƒƒã‚¯é€ä¿¡:', feedback);
    };

    // ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹è¡¨ç¤º
    function showFeedbackStatus(message, type) {
      const status = document.getElementById('feedbackStatus');
      if (status) {
        status.textContent = message;
        status.className = 'feedback-status ' + type;
        status.style.display = 'block';
      }
    }

    // ESCã‚­ãƒ¼ã§ãƒ¢ãƒ¼ãƒ€ãƒ«ã‚’é–‰ã˜ã‚‹
    document.addEventListener('keydown', function(e) {
      if (e.key === 'Escape') {
        closeFeedbackModal();
      }
    });
  })();
  </script>
</body>
</html>
